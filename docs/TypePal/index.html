<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-TypePal">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="The Rascal Meta Programming Language RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="The Rascal Meta Programming Language Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="The Rascal Meta Programming Language" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/release-notes/rss.xml" title="The Rascal Meta Programming Language RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/release-notes/atom.xml" title="The Rascal Meta Programming Language Atom Feed"><title data-rh="true">TypePal | The Rascal Meta Programming Language</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://rascal-mpl.org/docs/TypePal"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="TypePal | The Rascal Meta Programming Language"><meta data-rh="true" name="description" content="Synopsis."><meta data-rh="true" property="og:description" content="Synopsis."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://rascal-mpl.org/docs/TypePal"><link data-rh="true" rel="alternate" href="https://rascal-mpl.org/docs/TypePal" hreflang="en"><link data-rh="true" rel="alternate" href="https://rascal-mpl.org/docs/TypePal" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://FKSZQR9CR0-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.394b0ecf.css">
<link rel="preload" href="/assets/js/runtime~main.3f32e7f3.js" as="script">
<link rel="preload" href="/assets/js/main.ea59d2f2.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/rascal_large_no_text.png" alt="Rascal logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/rascal_large_no_text.png" alt="Rascal logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">The Rascal Meta Programming Language</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/WhyRascal">Docs</a><a class="navbar__item navbar__link" href="/stories">Stories</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/release-notes">Release notes</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/projects">Projects</a><a class="navbar__item navbar__link" href="/team">Team</a><a href="https://github.com/usethesource" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/WhyRascal">Why Rascal?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/GettingStarted">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/GettingHelp">Getting Help</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/RascalConcepts">Concepts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Rascal">Language Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Libraries">Libraries</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/RascalShell">Rascal Shell</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/TypePal">TypePal</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/RunTimeErrors">Runtime Errors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/CompileTimeErrors">Compile Time Errors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Rascalopedia">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Recipes">Recipes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/Troubleshooting">Troubleshooting Installation Problems</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/EditIni">Configure Eclipse for rascal</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">TypePal</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>TypePal</h1></header><p><strong>Synopsis.</strong></p><p>TypePal is a framework for name analysis, type checking and type inference</p><p><strong>Description.</strong></p><p>Many type checkers have already been written in Rascal with good results. However, type checkers for different languages
have a lot in common and address similar questions:</p><ul><li><p>How to handle declarations of names, in particular their scope and uses?</p></li><li><p>How to distinguish the roles names can play, e.g., names of functions, data types, labels, constants or variables?</p></li><li><p>How to handle imports and multiple name spaces?</p></li><li><p>How to associate requirements/constraints relevant for type checking with the syntax definition of the language
being type checked?</p></li><li><p>How to represent the types that occur in a program?</p></li><li><p>How to handle global or local type inference?</p></li><li><p>How to handle overloading?</p></li><li><p>How to give precise error messages (and avoid spurious messages)?</p></li><li><p>How to extract information that is useful for later compiler stages or the IDE for, e.g., code generation, use-def
information or name completion?</p></li></ul><p>TypePal is a Rascal framework that addresses the above questions and we describe here all its concepts, architecture and
features and also show some examples:</p><ul><li><p><a href="#TypePal-Overview">Overview</a>: An overview of TypePal.</p></li><li><p><a href="#TypePal-PocketCalculator">A Calculator Language</a>: Calc illustraties the basic facilities of TypePal.</p></li><li><p><a href="#TypePal-ConceptsAndDefinitions">Concepts and Definitions</a>: The concepts and definitions used in TypePal.</p></li><li><p><a href="#TypePal-Architecture">Architecture of TypePal</a>: Architectural overview of TypePal.</p></li><li><p><a href="#TypePal-Reporting">Reporting</a>: How to format and report errors, warnings and info messages.</p></li><li><p><a href="#TypePal-Collector">Collector</a>: A <code>Collector</code> collects constraints from source code and produces an initial
<code>TModel</code>.</p></li><li><p><a href="#TypePal-Solver">Solver</a>: A <code>Solver</code> tries to solve the constraints in a <code>TModel</code>; unsolved constraints produce
error messages.</p></li><li><p><a href="#TypePal-Configuration">TypePal Configuration</a>: Configuration options for TypePal.</p></li><li><p><a href="#TypePal-Utilities">Utilities</a>: Some utility functions.</p></li><li><p><a href="#TypePal-Examples">Examples of Typecheckers</a>: Examples of type checkers built with TypePal.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h2><p><strong>Synopsis.</strong></p><p>An overview of TypePal</p><p><strong>Description.</strong></p><p>TypePal is a declarative framework that operates on a model of the program to be type checked that consisting of</p><ul><li><p><em>facts</em> that some source code fragment has a known type, e.g., an integer literal is of type integer, or that its
type is equal to the type of another source code fragment, e.g., the type of the expression in parentheses <code>( e )</code>
is equal to the type of <code>e</code>.</p></li><li><p><em>calculators</em> that compute the type of a source code fragment and create new facts; this computation may also need
the types of one or more other source code fragments, e.g., computing the type of the addition operator is based on
the types of its operands.</p></li><li><p><em>requirements</em> that are imposed on a source code fragment by the type system being used; a requirement may need the
types of one or more other source code fragments, e.g., if the expression on the right-hand side of an assignment
has type integer, then the type of the variable on the left-hand side should be compatible with the type integer.</p></li></ul><p>We call this model the <em>TModel</em> (for &quot;Type Model&quot;) of the program: facts describe elementary observations and equalities
between types, calculators compute new type facts, and requirements impose restrictions on the types of program
fragments. A requirement or calculator may detect a type violation and will then generate an error message. When a
requirement is satisfied or a calculator computes a new type, this leads to the creation of new facts that may trigger
the computation of other requirements and calculators.</p><p>Technically, TypePal uses <em>scope graphs</em> for expressing definition and use of names (including their role, scope, name
space, and visibility), and <em>constraints</em> to describe facts, requirements and calculators. These constraints are such
that they can express either type checking or type inference, or a mixture thereof. Under the hood, these constraints
are solved in an efficient, data-driven, fashion.</p><p>TypePal is highly parameterized and can be adapted to specific type checking needs.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-calculator-language">A Calculator Language<a class="hash-link" href="#a-calculator-language" title="Direct link to heading">​</a></h2><p><strong>Synopsis.</strong></p><p>Calc illustraties the basic facilities of TypePal</p><p><strong>Description.</strong></p><p>By developing a type checker for <strong><em>Calc</em></strong>, a tiny pocket calculator language, we illustrate elementary usage of
TypePal. The full source code of Calc can be found at
<a href="https://github.com/cwi-swat/typepal/tree/master/src/examples/calc" target="_blank" rel="noopener noreferrer">https://github.com/cwi-swat/typepal/tree/master/src/examples/calc</a>. See <a href="#TypePal-Examples">Examples of Typecheckers</a>
for a list of all available type checker examples.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="syntax-of-calc">Syntax of Calc<a class="hash-link" href="#syntax-of-calc" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module lang::calc::Syntax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extend lang::CommonLex;     </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">start syntax Calc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    = Decl+                 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syntax Decl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    = &quot;var&quot; Id &quot;=&quot; Exp &quot;;&quot;  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">syntax Exp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   = Id                             </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   | Integer                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   | Boolean                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   | bracket &quot;(&quot; Exp &quot;)&quot;            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &gt; left Exp &quot;*&quot; Exp               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &gt; left Exp &quot;+&quot; Exp               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   &gt; &quot;if&quot; Exp &quot;then&quot; Exp &quot;else&quot; Exp </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keyword Reserved</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    = &quot;var&quot; | &quot;if&quot; | &quot;then&quot; | &quot;else&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>For brevity we use some common lexical definitions in <code>lang::CommonLex</code>. They take, amongst others, care of
whitespace, comments and definitions for integer and Boolean constants (<code>Integer</code> and <code>Boolean</code>) as well as
identifiers (<code>Id</code>).</p></li><li><p>A Calc program consists of one or more declarations (<code>Decl</code>).</p></li><li><p>Each declaration introduces a new variable and binds it to the value of an expression.</p></li><li><p>An expression can be an identifier (that should have been introduced in a preceding declaration), or</p></li><li><p>an integer constant, or</p></li><li><p>a Boolean constant, or</p></li><li><p>be surrounded by parentheses, or</p></li><li><p>a multiplication (arguments should have the same type), or</p></li><li><p>an addition (arguments should have the same type), or</p></li><li><p>a conditional expression (the first expression should have type Boolean, the other two should have the same type).</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="typechecking-calc">Typechecking Calc<a class="hash-link" href="#typechecking-calc" title="Direct link to heading">​</a></h3><p>Type checking Calc amounts to checking the following:</p><ul><li><p>Every name that is used in an expression should have been defined in a declaration and has the type of the
expression in that declaration.</p></li><li><p>Addition or multiplication on integers yields an integer type.</p></li><li><p>Addition or multiplication on Booleans yields a Boolean type.</p></li><li><p>The condition in a condional expression should be Boolean.</p></li><li><p>The then and else part of a conditional expression should have the same type; that type becomes the type of the
conditional expression.</p></li></ul><p>Let’s now move to the Calc type checker described in <code>lang::calc::Checker</code>. We break it up in parts and describe the
parts as we go. You should be explicitly aware of the fact that type checking consists of two phases:</p><ul><li><p><em>Collecting facts and constraints</em>: this is all about formulating constraints and attaching them to parts of the
source program. In this phase types are unknown and constraints can only be created but not yet solved. All
computations on types have therefore to be postponed until the solving phase. We will see how in a minute.</p></li><li><p><em>Solving constraints</em>: constraints are solved (if possible) and types are assigned to parts of the source program.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="begin-of-type-checker-module-for-calc">Begin of type checker module for Calc<a class="hash-link" href="#begin-of-type-checker-module-for-calc" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module lang::calc::Checker</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import lang::calc::Syntax;                  // The Calc syntax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extend analysis::typepal::TypePal;          // TypePal</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We import the Calc syntax <code>lang::calc::Syntax</code> and then we <em>extend</em> the TypePal <code>analysis::typepal::TypePal</code>.</p><blockquote><p><strong>Note</strong></p><p>There is a technical reason why we have to extend TypePal rather than import it. Some data types (e.g., <code>AType</code>) and
functions (e.g., <code>collect</code>) are already defined in TypePal itself and they are being extended in each type checker.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="extend-atype">Extend AType<a class="hash-link" href="#extend-atype" title="Direct link to heading">​</a></h3><p>TypePal has a built-in data type to represent types: <code>AType</code>. This data type can be extended to represent
language-specific types.</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data AType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    = boolType()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | intType()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">str prettyAType(boolType()) = &quot;bool&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">str prettyAType(intType()) = &quot;int&quot;;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The values in Calc are Booleans and integers and we create two <code>AType</code> constants <code>boolType()</code> and <code>intType()</code> to
represent these types. <code>prettyAType</code> converts them back to a string representation; this is used in error reporting.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="collecting-facts-and-constraints">Collecting facts and constraints<a class="hash-link" href="#collecting-facts-and-constraints" title="Direct link to heading">​</a></h3><p>Writing a type checker in TypePal amounts to collecting facts and constaints from a source program to be checked. This
is achieved by the <code>collect</code> function that has the form</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: syntactic pattern, Collector c){ ... }`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where <em>syntactic pattern</em> corresponds with a rule from the language syntax, in this case <code>lang::calc::Syntax</code>. The
<code>Collector</code> argument provides methods to add facts and constraints.</p><blockquote><p><strong>Note</strong></p><p>One <code>collect</code> declaration is needed per alternative in the syntax but some rules (i.e., chain rules) are handled
automatically.</p></blockquote><blockquote><p><strong>Note</strong></p><p>By convention the syntactic pattern is named <code>current</code> and the Collector is named <code>c</code>.</p></blockquote><blockquote><p><strong>Warning</strong></p><p>Each <code>collect</code> declaration is responsible for calling <code>collect</code> on relevant subparts (a run-time error is given for a
missing <code>collect</code>).</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="check-declaration">Check Declaration<a class="hash-link" href="#check-declaration" title="Direct link to heading">​</a></h5><p>A declaration introduces a new name and associates the type of the righthand side expression with it.</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: (Decl) `var &lt;Id name&gt; = &lt;Exp exp&gt; ;`, Collector c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c.define(&quot;&lt;name&gt;&quot;, variableId(), current, defType(exp));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    collect(exp, c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here we define <code>name</code> as a variable and define its type as the same type as <code>exp</code>. Let’s digest this:</p><ul><li><p><code>c.define(…​)</code> calls the <code>define</code> function in the <code>Collector</code> and adds this definition to the internal state of the
Collector.</p></li><li><p><code>name</code> is a parse tree for the lexical syntax rule <code>Id</code>. <code>&quot;&lt;name&gt;&quot;</code> reduces this tree to a string and this is how
the variable can be used later on.</p></li><li><p><code>variableId()</code> defines that the role of this name (<code>IdRole</code>) is a variable. <code>variableId</code> is a built-in role
<code>IdRole</code>.</p></li><li><p><code>current</code> is the parse tree of the whole declaration, we use it as unique identification of the definition of
<code>name</code>.</p></li><li><p><code>defType</code> is used to define the type of <code>name</code> and it comes in several flavours. Here, we use another parse tree
fragment <code>exp</code> as argument. <code>defType(exp)</code> should be read as <em>the same type as</em> <code>exp</code> and the effect is that <code>name</code>
is defined having the same type as <code>exp</code>. This implies that the type of <code>name</code> can only be known when the type of
<code>exp</code> is known.</p></li></ul><h5 class="anchor anchorWithStickyNavbar_LWe7" id="check-exp-id">Check Exp: Id<a class="hash-link" href="#check-exp-id" title="Direct link to heading">​</a></h5><p>An expression consisting of a single identifier, refers to a name introduced in another declaration and gets the type
introduced in that declaration.</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: (Exp) `&lt;Id name&gt;`, Collector c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c.use(name, {variableId()});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>An expression consisting of a single identifier represents a <em>use</em> of that identifier. <code>c.use(name, roles)</code> records
this. There are then two possibilities:</p><ul><li><p>a matching define is found for one of the given roles: use and definition are connected to each other.</p></li><li><p>no matching define is found and an error is reported.</p></li></ul><blockquote><p><strong>Note</strong></p><p>In larger languages names may be defined in different scopes. Scopes do not play a role in Cal.</p></blockquote><blockquote><p><strong>Note</strong></p><p>We do not enforce <em>define-before-use</em> in this example, but see <a href="#XXX">???</a> how to achieve this.</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="check-exp-boolean-and-integer-constants">Check Exp: Boolean and Integer constants<a class="hash-link" href="#check-exp-boolean-and-integer-constants" title="Direct link to heading">​</a></h5><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: (Exp) `&lt;Boolean boolean&gt;`, Collector c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c.fact(current, boolType());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: (Exp) `&lt;Integer integer&gt;`, Collector c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c.fact(current, intType());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When encountering a Boolean or integer constant we record their type using <code>c.fact(current, its type)</code>.</p><blockquote><p><strong>Note</strong></p><p>The second argument of <code>fact</code> maybe an <code>AType</code>, an arbitrary parse tree (in which case the type of that tree will be
used), or a function that returns a type.</p></blockquote><h5 class="anchor anchorWithStickyNavbar_LWe7" id="check-exp-parentheses">Check Exp: parentheses<a class="hash-link" href="#check-exp-parentheses" title="Direct link to heading">​</a></h5><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: (Exp) `( &lt;Exp e&gt; )`, Collector c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c.fact(current, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    collect(e, c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The type of an expression enclosed by parentheses is the same as the same of the enclosed expression.</p><p>A final, essential, step is to collect constraints from the subpart <code>e</code>.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="check-exp-addition">Check Exp: addition<a class="hash-link" href="#check-exp-addition" title="Direct link to heading">​</a></h5><p>Addition of integers given an integer result and addition of Booleans gives a Boolean result.</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: (Exp) `&lt;Exp e1&gt; + &lt;Exp e2&gt;`, Collector c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     c.calculate(&quot;addition&quot;, current, [e1, e2],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AType (Solver s) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            switch(&lt;s.getType(e1), s.getType(e2)&gt;){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                case &lt;intType(), intType()&gt;: return intType();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                case &lt;boolType(), boolType()&gt;: return boolType();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    s.report(error(current, &quot;`+` not defined for %t and %t&quot;, e1, e2));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collect(e1, e2, c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Checking addition is more complex since we need the type of sub expressions <code>e1</code> and <code>e2</code> in order to do our job. The
type of an arbitrary parse tree can be computed using</p><p><code>c.calculate(informative label, current, list of dependencies, AType(Solver s) { …​ }</code>.</p><p>where</p><ul><li><p><em>informative label</em> is a label that can be used in error messages and log files.</p></li><li><p><code>current</code> is the parse tree for which we are computing a type.</p></li><li><p><em>list of dependencies</em> is a list of other parse trees whose type is needed in the computation of the type of
<code>current</code>.</p></li><li><p><code>AType(Solver s) { …​ }</code> performs the type computation:</p><ul><li><p>it is only called when the types of all dependencies are known.</p></li><li><p>it has a <code>Solver</code> as argument: a <code>Solver</code> manages the constraint solving process and is aware of all facts and
solved constraints so far and knows, for instance, about the existence of type information for some parse tree.</p></li><li><p>it either returns an <code>AType</code> or reports an error.</p></li></ul></li></ul><p>The above code could be paraphrased as follows: <em>The type of <code>current</code> can only be computed when the types of <code>e1</code> and
<code>e2</code> are known. When known, get their types (using <code>s.getType</code>) and distinguish cases: two integer arguments give an
integer result type and two Boolean arguments a Boolean result type; otherwise report an error.</em></p><p>A final, essential, step is to collect constraints from the subparts <code>e1</code> and <code>e2</code>.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="check-exp-multiplication">Check Exp: multiplication<a class="hash-link" href="#check-exp-multiplication" title="Direct link to heading">​</a></h5><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: (Exp) `&lt;Exp e1&gt; * &lt;Exp e2&gt;`, Collector c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     c.calculate(&quot;multiplication&quot;, current, [e1, e2],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AType (Solver s) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            switch(&lt;s.getType(e1), s.getType(e2)&gt;){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                case &lt;intType(), intType()&gt;: return intType();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                case &lt;boolType(), boolType()&gt;: return boolType();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    s.report(error(current, &quot;`*` not defined for %t and %t&quot;, e1, e2));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collect(e1, e2, c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Checking multiplication follows exactly the same pattern as checking addition. Even in this simple example we see
repetition of code that could be factored out.</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="check-exp-conditional-expression">Check Exp: conditional expression<a class="hash-link" href="#check-exp-conditional-expression" title="Direct link to heading">​</a></h5><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: (Exp) `if &lt;Exp cond&gt; then &lt;Exp e1&gt; else &lt;Exp e2&gt;`, Collector c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c.calculate(&quot;if Exp&quot;, current, [cond, e1, e2],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AType(Solver s){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            s.requireEqual(cond, boolType(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                           error(cond, &quot;Condition should be Boolean, found %t&quot;, cond));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            s.requireEqual(e1, e2,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                           error(current, &quot;Equal types required, found %t and %t&quot;, e1, e2));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return s.getType(e1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    collect(cond, e1, e2, c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Checking a conditional expression amounts to checking that the condition has type Boolean and that the then and else
branch have the same type (which also becomes the type of the conditional expression as a whole). In the above code we
see <code>s.requireEqual(arg1, arg2, message)</code>. Here <em>arg1</em> and <em>arg2</em> may either be a subtree (in which case its type is
used) or an <code>AType</code>. <code>requireEqual</code> requires that both types are equal or reports an error.</p><p>A final, essential, step is to collect constraints from the subparts <code>cond</code>, <code>e1</code> and <code>e2</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing-the-calc-typechecker">Testing the Calc typechecker<a class="hash-link" href="#testing-the-calc-typechecker" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getting-started">Getting started<a class="hash-link" href="#getting-started" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">module lang::calc::Test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extend lang::calc::Checker;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">extend analysis::typepal::TestFramework;    // TypePal test utilities</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import ParseTree;                           // In order to parse tests</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We need three ingredients for testing:</p><ul><li><p><code>lang::calc::Checker</code>, the Calc type checker we have just completed.</p></li><li><p><code>analysis::typepal::TestFramework</code>, the TypePal test framework which enables test automation.</p></li><li><p><code>ParseTree</code> that provides parsing functionality that is needed to parse Calc source text.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="manual-testing">Manual testing<a class="hash-link" href="#manual-testing" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TModel calcTModelFromTree(Tree pt){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return collectAndSolve(pt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Given a parse tree <code>pt</code> for a Calc program, we apply <a href="#_collectandsolve">collectAndSolve</a> to it. This creates a
Collector, uses it to collect constraints from <code>pt</code> and then creates a Solver to solve all constraints. The result is a
<code>TModel</code>. <code>calcTModelFromTree</code> will also be used during automated testing.</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TModel calcTModelFromStr(str text){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pt = parse(#start[Calc], text).top;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return calcTModelFromTree(pt);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In order to obtain a parse tree, we need to parse it as shown above.</p><p>TModels contain much information but here we are only interested in the messages that have been generated during
constraint solving. They are contained in the <code>messsages</code> field of a TModel.</p><p>With the above machinery in place we can perform some experiments:</p><ul><li><p><code>calcTModelFromStr(&quot;var x = 3;&quot;),messages</code> gives no messages.</p></li><li><p><code>calcTModelFromStr(&quot;var x = 3+true;&quot;).messsages</code> reports that addition of integer and Boolean is illegal.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="automated-testing">Automated testing<a class="hash-link" href="#automated-testing" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bool calcTests() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     return runTests([|project://typepal-examples/src/lang/calc/tests.ttl|],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     #Calc, calcTModelFromTree);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>TypePal’s testing framework enables scripting of tests. Each script is written in TTL (TypePal Testing Language). Use
<code>runtests(list of TTL files, start non-terminal, function to create a TModel)</code> to execute the scripts.</p><p>Here is a sample script:</p><div class="language-TTL codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-TTL codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">test Ok1 [[ var x = 1; ]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test Ok2 [[ var x = 1; var y = x + 2; ]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test Undef1 [[ var x = y; ]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expect { &quot;Undefined variable `y`&quot; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test Add1 [[ var x = 1 + 2; ]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test Add2 [[ var x = true + false; ]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test Add3 [[ var x = 1 + true; ]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expect { &quot;`+` not defined for `int` and `bool`&quot; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test If1 [[ var x = if true then 1 else 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            var y = x + 1;]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test If2 [[ var x = if true then 1 else false; ]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expect { &quot;Equal types required, found `int` and `bool`&quot; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">test If3 [[ var x = if 1 then 2 else 3; ]]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expect { &quot;Condition should be Boolean, found `int`&quot; }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and here is the produced output:</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Test Ok1: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test Ok2: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test Undef1: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test Add1: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test Add2: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test Add3: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test If1: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test If2: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test If3: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Test summary: 9 tests executed, 9 succeeded, 0 failed</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="concepts-and-definitions">Concepts and Definitions<a class="hash-link" href="#concepts-and-definitions" title="Direct link to heading">​</a></h2><p><strong>Synopsis.</strong></p><p>The concepts and definitions used in TypePal.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="identifier">Identifier<a class="hash-link" href="#identifier" title="Direct link to heading">​</a></h3><p>The syntax of a source language may impose various restrictions on the identifiers that can occur in a program. They
amount to including or excluding specific characters for various occurrences of names in the program. One example is the
requirement in Java that class names start with an upper case letter. TypePal is agnostic of such conventions and
represents each name as a string. <em>Qualified names</em> are also supported and are represented by a list of strings.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tree">Tree<a class="hash-link" href="#tree" title="Direct link to heading">​</a></h3><p>The Rascal data type <code>Tree</code> (REF) is used to represent all parse trees that can be generated for any syntax described in
Rascal. <code>Tree</code> is also a super type of any syntactic construct that may occur in a parse tree. In TypePal we
interchangeably use <code>Tree</code> and the source area (a source location) associated with it to uniquely identify program
parts, definitions, uses and scopes.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="scope">Scope<a class="hash-link" href="#scope" title="Direct link to heading">​</a></h3><p>A <em>scope</em> is a region of a program that delimits where definitions of identifier are applicable. An identifier is
defined in the scope where it is defined and in all nested subscopes, unless one of these subscopes redefines that same
identifier. In that case, the inner definition applies inside that nested scope (and its subscopes). Scopes are
identified by the subtree of the parse tree that introduces them such as, for instance, a module, a function declaration
or a block. Special rules may apply such as <em>define-before-use</em> or <em>scopes-with-holes</em>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="scope-graph">Scope Graph<a class="hash-link" href="#scope-graph" title="Direct link to heading">​</a></h3><p>The scope graph is one of the the oldest methods to describe the scope of names in a program. We use a version of scope
graphs as described by Kastens &amp; Waite, <em>Name analysis for modern languages: a general solution</em>, SP\&amp;E, 2017. This
model uses text ranges in the source text (happily represented by Rascal’s <code>loc</code> data type) to identify and define all
aspects of names. A scope graph provides lookup operations on names that take both syntactic nesting and semantic
linking (via <em>paths</em>) into account, as well as the specific roles of identifiers and paths (described below).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="identifier-definition">Identifier definition<a class="hash-link" href="#identifier-definition" title="Direct link to heading">​</a></h3><p>The <em>definition</em> of an identifier is inside TypePal characterized by a <code>Define</code>:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">alias Define  = tuple[loc scope, str id, IdRole idRole, loc defined, DefInfo defInfo];</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where</p><ul><li><p><code>scope</code> is the scope in which the definition occurs;</p></li><li><p><code>id</code> is the text representation of the identifier;</p></li><li><p><code>idRole</code> is the role in which the identifier is defined, see <a href="#_identifier_role">Identifier Role</a>;</p></li><li><p><code>defined</code> is source code area of the definition;</p></li><li><p><code>defInfo</code> is any additional information associated with this definition, see <a href="#_definfo">DefInfo</a>,</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="identifier-use">Identifier Use<a class="hash-link" href="#identifier-use" title="Direct link to heading">​</a></h3><p>The <em>use</em> of an identifier is characterized by a <code>Use</code>:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data Use</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    = use(str id, loc occ, loc scope, set[IdRole] idRoles)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | useq(list[str] ids, loc occ, loc scope, set[IdRole] idRoles, set[IdRole] qualifierRoles)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where <code>use</code> represents the use of a simple name and <code>useq</code> that of a qualified name. In the latter case, a list of
strings is given; the last string is a simple name in given <code>idRoles</code> and the preceeding strings are its qualifiers in
<code>qualifierRoles</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="path">Path<a class="hash-link" href="#path" title="Direct link to heading">​</a></h3><p>TypePal is based on scope graphs that are not only based on syntactic containment of scopes but can also express
semantic connections between parse trees. While scopes are strictly determined by the hierarchical structure of a
program (i.e., its parse tree), <em>paths</em> provide an escape from this restriction and define a semantic connection between
syntactic entities that are not hierarchically related and may even be part of different syntax trees. Connections
between syntactic entities are paths labelled with user-defined roles. Paths are represented by the Rascal datatype
<code>PathRole</code>. An example is the import of a module <em>M</em> into another module <em>N</em> that makes the entities in <em>M</em> known inside
<em>N</em>. Here is an example of a path role to mark an import path between two parse trees.</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data PathRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    = importPath()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Paths are, amongst others, used in the resolution of qualified names.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="name-resolution">Name Resolution<a class="hash-link" href="#name-resolution" title="Direct link to heading">​</a></h3><p>Name resolution is based on the principle: <em>syntactic resolution first, semantic resolution second</em>. This means that we
first search for a definition in the current parse tree and only when that fails we follow semantic path to other trees
(either in the current tree or in other trees):</p><ul><li><p>First the current scope in which the name is used is searched for a definition.</p></li><li><p>If this fails surrounding scopes are searched.</p></li><li><p>If this fails semantic paths in the same parse tree or to other parse trees are searched, such as, for instance,
provided by an import statement.</p></li></ul><p>This is illustrated below, where a name occurrence <em>O</em> can be resolved to definitions <em>D1</em> (syntactic resolution), <em>D2</em>
(semantic resolution) and/or <em>D3</em> (semantic resolution).</p><p><img loading="lazy" alt="400" src="/assets/images/NameResolution-f9b3b4ea0d30b1d1a57f7871cf241bc4.png" width="471" height="468" class="img_ev3q"></p><blockquote><p><strong>Important</strong></p><p>Name resolution need not have a unique solution. Therefore the author of a TypePal-based type checker can provide
functions to (a) filter valid solutions; (b) determine which identifiers may be overloaded.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="role">Role<a class="hash-link" href="#role" title="Direct link to heading">​</a></h3><p>Identifiers, scopes and path can play different <em>roles</em> that determine how they will be handled. They are represented by
various Rascal datatypes that can be extended by the author of a typechecker.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="identifier-role">Identifier Role<a class="hash-link" href="#identifier-role" title="Direct link to heading">​</a></h3><p>Identifier roles are modelled by the data type <code>IdRole</code>. Here is an example where roles are introduced for constants,
variables, formal parameters and functions:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data IdRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    = constantId()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | variableId()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | formalId()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | functionId()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When <em>defining</em> an identifier, the specific role of that identifier has to be given, e.g. as <code>constantId()</code>. When
<em>using</em> an identifier, the set of acceptables roles has to be given. For instance, an identifier used in an expression
may accept the roles <code>{ constantId(), variableId(), formalId() }</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="scope-role">Scope Role<a class="hash-link" href="#scope-role" title="Direct link to heading">​</a></h3><p>Scope roles are modelled by the data type <code>ScopeRole</code> and are used to distinguish different kinds of scopes. Later (REF)
we will see that this can be used, for instance, to search for the innermost scope with a specific role, say the
innermost function scope. Here is an example that introduces scopes for functions and loops:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data ScopeRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    = functionScope()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | loopScope()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="path-role">Path Role<a class="hash-link" href="#path-role" title="Direct link to heading">​</a></h3><p>Path roles are modelled by the data type <code>PathRole</code>:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data PathRole</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    = importPath()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | extendPath()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="types">Types<a class="hash-link" href="#types" title="Direct link to heading">​</a></h3><p>The type to be associated with names varies widely for different programming languages and has to be provided by the
typechecker author. TypePal provides the data type <code>AType</code> that provides already some built-in constructors:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data AType</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   = tvar(loc tname)                                    </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   | atypeList(list[AType] atypes)                      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   | overloadedAType(rel[loc, IdRole, AType] overloads) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   | lazyLub(list[AType] atypes)                        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p><code>tvar</code> represents a type variable (used for type inference) and is only used internally.</p></li><li><p><code>atypeList</code> represents a list of <!-- -->`<!-- -->AType<!-- -->`<!-- -->s and is used both internally in TypePal but can also be used in
typechecker definitions.</p></li><li><p><code>overloadedAType</code> represents overloaded types.</p></li><li><p><code>lazyLub</code> represents a lazily computed LUB of a list of types.</p></li></ul><p>AType that has to be extended with language-specific types.</p><p>The typechecker author also has to provide a function to convert <code>AType</code> to string (it is used create readable error
messages):</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">str prettyAType(AType atype);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="definfo">DefInfo<a class="hash-link" href="#definfo" title="Direct link to heading">​</a></h3><p>When defining a name, we usually want to associate information with it such as the type of the defined name. TypePal
provides the data type <code>DefInfo</code> for this purpose:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data DefInfo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    = noDefInfo()                                                                           </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | defType(value contrib)                                                                </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | defTypeCall(list[loc] dependsOn, AType(Solver s) getAType)                            </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | defTypeLub(list[loc] dependsOn, list[loc] defines, list[AType(Solver s)] getATypes)   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>No information associated with this definition.</p></li><li><p>Explicitly given AType contribution associated with this definition. <code>contrib</code> can either be an <code>AType</code>, or a
<code>Tree</code>. In the latter case, the type of that tree is used (when it becomes available) for the current definition.</p></li><li><p>Type of this definition depends on the type of the entities given in <code>dependsOn</code>, when those are known, <code>getAType</code>
can construct the type of this definition. <code>getAType</code> will only be called by TypePal during constraint solving.</p></li><li><p>Refine a set of definitions by taking their LUB, mostly used for local type inference.</p></li></ul><p>The <a href="#TypePal-Solver">Solver</a> argument of <code>getAType</code> and <code>getATypes</code> is the current constraint solver being used.</p><blockquote><p><strong>Warning</strong></p><p>noDefInfo may be removed.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="architecture-of-typepal">Architecture of TypePal<a class="hash-link" href="#architecture-of-typepal" title="Direct link to heading">​</a></h2><p><strong>Synopsis.</strong></p><p>Architectural overview of TypePal</p><p><strong>Description.</strong></p><p>Type checking using TypePal proceeds in the following stages:</p><ul><li><p><em>Parse</em> the program to be analyzed using its syntax definition, the result is a parse tree;</p></li><li><p><em>Collect</em> constraints (facts, calculators, and requirements) from the parsed program and build an initial <code>TModel</code>
using these collected constraints;</p></li><li><p><em>Solve</em> the constraints, the result is a validated and further enriched <code>TModel</code>. This amounts to executing
calculators and requirements when the types on which they depend become available. This also involves resolving the
semantic links between program parts as introduced by, e.g., import statements.</p></li></ul><p>This approach is very flexible, since each of the stages can be called separately, enabeling a pipeline with
user-defined model transformations inbetween.</p><p><img loading="lazy" alt="900" src="/assets/images/Architecture-51a77f24a0832f64fad8457232285e73.png" width="1105" height="788" class="img_ev3q"></p><p>This whole process starts with a syntax for the language we want to analyze (let’s call that language <em>L</em> for now). The
<em>L</em> syntax is used to parse the <em>L</em> program we want to type check. The result is a parse tree.</p><p>Collecting constraints from the resulting parse tree is based on the builder pattern: first a new
<a href="#TypePal-Collector">Collector</a> is created (using <code>newCollector</code>) and that enables the author of the type checker to add
facts, requirements and calculators to the <code>TModel</code> depending on the specific input program. The Collector calls
user-defined <code>collect</code> functions for each language construct. This collection process is strictly <em>local</em> and based on
the nested structure of the parse tree and the result is an initial <code>TModel</code>.</p><p>After the Collector phase, a <code>TModel</code> is available whose constraints can be solved (or not). This is done by creating a
new <a href="#TypePal-Solver">Solver</a> (using <code>newSolver</code>) and running it on the given <code>TModel</code>.</p><p>TypePal can be configured using a <a href="#TypePal-Configuration">TypePal Configuration</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="reporting">Reporting<a class="hash-link" href="#reporting" title="Direct link to heading">​</a></h2><p><strong>Synopsis.</strong></p><p>How to format and report errors, warnings and info messages.</p><p><strong>Description.</strong></p><p>Reporting may be done both in the Collector and the Solver. It uses values of the datatype <code>FailMessage</code> that can be
created as follows:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">FailMessage error(value src, str msg, value args...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FailMessage warning(value src, str msg, value args...);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FailMessage info(value src, str msg, value args...);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here,</p><ul><li><p><code>src</code> is a <code>Tree</code> or <code>loc</code> that is the subject of the report.</p></li><li><p><code>msg</code> is an informative string to be printed. It may contain <em>insertion directives</em>.</p></li><li><p><code>args</code> are zero or more values to be inserted in the insertion directives in <code>msg</code>.</p></li></ul><p>The following insertion directives are supported:</p><ul><li><p><code>%t</code>: insert the <em>type</em> of the next element of <code>args</code>.</p></li><li><p><code>%v</code>: insert the <em>value</em> of the next element of <code>args</code>.</p></li><li><p><code>%q</code>: quote and insert the <em>type</em> or <em>value</em> of the next element of <code>args</code>.</p></li><li><p><code>%%</code>: insert the character <code>%</code>.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="collector">Collector<a class="hash-link" href="#collector" title="Direct link to heading">​</a></h2><p><strong>Synopsis.</strong></p><p>A <code>Collector</code> collects constraints from source code and produces an initial <code>TModel</code>.</p><p><strong>Description.</strong></p><p>A <code>Collector</code> is a statefull object that provides all the functions described below to access and change its internal
state. The global services provided by a <code>Collector</code> are:</p><ul><li><p>Register facts, calculators, and requirements as collected from the source program.</p></li><li><p>Maintain a global (key,value) store to store global information relevant for the collection process. Typical
examples are:</p><ul><li><p>Configuration information.</p></li><li><p>The files that have been imported.</p></li></ul></li><li><p>Manage scopes.</p></li><li><p>Maintain a single value per scope. This enables decoupling the collection of information from separate but related
language constructs. Typical examples are:</p><ul><li><p>While collecting information from a function declaration: create a new function scope and associate the required
return type with it so that return statements in the function body can check that (a) they occur inside a
function; (b) that the type of their returned value is compatible with the required return type.</p></li><li><p>While collecting information from an optionally labelled loop statement: create a new loop scope and associate
the label with it so that break/continue statements can check that: (a) they occur inside a loop statement; (b)
which loop statement they should (dis)continue.</p></li></ul></li><li><p>Reporting.</p></li></ul><p>The functions provided by a <code>Collector</code> are summarized below:</p><p><img loading="lazy" alt="800" src="/assets/images/Collector-59322b84ff51347cd9021affca0e191e.png" width="562" height="573" class="img_ev3q"></p><p>Three dozen functions are available that fall into the following categories:</p><ul><li><p><em>Lifecycle of Collector</em>: create a new <code>Collector</code>, use it to <code>collect</code> information from a source program, and
produce a TModel.</p></li><li><p><em>Configuration</em>: retrieve or modify configuration settings.</p></li><li><p><em>Scoping</em>: enter or leave a scope, ask for current scope.</p></li><li><p><em>Scope Info</em>: add information to the current scope or retrieve that information.</p></li><li><p><em>Nested Info</em>: maintain nested information during collection; this is only available during collection.</p></li><li><p><em>Composition</em>: add another TModel to the current one.</p></li><li><p><em>Reporting</em>: report errors, warnings and info messages.</p></li><li><p><em>Add Path</em>: add paths to the scope graph.</p></li><li><p><em>Define</em>: define identifiers in various ways.</p></li><li><p><em>Use</em>: use identifiers in various ways.</p></li><li><p><em>Inference</em>: create new type variables for type inference.</p></li><li><p><em>Facts</em>: establish facts.</p></li><li><p><em>Calculate</em>: define calculators.</p></li><li><p><em>Require</em>: define requirements.</p></li></ul><p>Technically, <code>Collector</code> is a datatype with a single constructur and a number of functions as fields, For instance,
given a <code>Collector</code> named <code>c</code>, calling the <code>define</code> function amounts to: <code>c.define(the-arguments-of-define)</code>. All
Collector functions are prefixed with <code>/* Collector field */</code> to emphasize that they are a field of the Collector
datatype.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="lifecycle-of-collector">LifeCycle of Collector<a class="hash-link" href="#lifecycle-of-collector" title="Direct link to heading">​</a></h3><p>A new <code>Collector</code> is created using the function <code>newCollector</code>.</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Collector newCollector(str modelName, Tree pt, TypePalConfig config = tconfig());</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where</p><ul><li><p><code>modelName</code> is the name of the TModel to be created (used for logging);</p></li><li><p><code>pt</code> is the parse tree of the source program to be type checked;</p></li><li><p><code>config</code> is a <a href="#TypePal-Configuration">TypePal Configuration</a>.</p></li></ul><p>Once a Collector has been created, the user-defined <code>collect</code> function is invoked with the current parse tree of a
source program and the Collector as arguments. The <code>collect</code> function is applied recursively until all information has
been collected from the source program.</p><p>Finally, <code>run</code> creates the desired <code>TModel</code> that will be used by the <a href="#TypePal-Solver">Solver</a>:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ TModel () run;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A typical scenario is (for a given a parse tree <code>pt</code> of the program to be checked):</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">c = newCollector(&quot;my_model&quot;, pt);   // create Collector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collect(pt, c);                     // collect constraints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">model = c.run();                    // create initial TModel to be handled by the Solver</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>collect</code> function has to be supplied by the author of the type checker and looks like this:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void collect(LanguageConstruct lc, Collector c){ ... }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where:</p><ul><li><p><code>lc</code> is a syntactic type from the language under consideration.</p></li><li><p><code>c</code> is a <code>Collector</code>.</p></li></ul><blockquote><p><strong>Important</strong></p><p>Each <code>collect</code> function is responsible for collecting constraints from its subtrees.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a class="hash-link" href="#configuration" title="Direct link to heading">​</a></h3><p>The <a href="#TypePal-Configuration">TypePal Configuration</a> can be retrieved or adjusted by the following two functions:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ TypePalConfig () getConfig;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (TypePalConfig cfg) setConfig;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The former returns the current TypePal configuration, the latter sets the current configuration to a new configuration.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="scoping">Scoping<a class="hash-link" href="#scoping" title="Direct link to heading">​</a></h3><p>Scope management amounts to entering a new scope, leave the current scope and retrieving the current scope:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (Tree inner) enterScope;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (Tree inner) leaveScope;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ loc () getScope,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In order to check consistency, <code>leaveScope</code> has the inner scope that it is supposed to be leaving as argument.</p><p>Here is an example how the <code>let</code> expression in <a href="#_fun">Fun</a> handles subscopes:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: (Expression) `let &lt;Id name&gt; : &lt;Type tp&gt; = &lt;Expression exp1&gt; in &lt;Expression exp2&gt; end`, Collector c) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     c.enterScope(current);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         c.define(&quot;&lt;name&gt;&quot;, variableId(), name, defType(tp));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         c.calculate(&quot;let&quot;, current, [exp2], AType(Solver s) { return s.getType(exp2); } );</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         collect(tp, exp1, exp2, c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     c.leaveScope(current);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="scope-info">Scope Info<a class="hash-link" href="#scope-info" title="Direct link to heading">​</a></h3><p>It is possible to associate auxiliary information with each scope. This enables the downward propagation of information
during the topdown traversal of the source program by <code>collect</code>. Typical use cases are:</p><ul><li><p>recording the return type of a function declaration and checking that all return statements in the body of that
function have a type that is compatible with the declared return type.</p></li><li><p>recording the label of a loop statement for the benefit of nested break or continue statements.</p></li></ul><p>Scopes are identified by their source location and <code>ScopeRole</code>: a user-defined data type that distinsguishes possible
roles such as <code>functionScope()</code> or <code>labelScope()</code>.</p><p><code>setScopeInfo</code> sets the information for a scope:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (loc scope, ScopeRole scopeRole, value info) setScopeInfo;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where</p><ul><li><p><code>scope</code> is the scope for which information is to be set.</p></li><li><p><code>scopeRole</code> is the role of that scope.</p></li><li><p><code>info</code> is the associated information.</p></li></ul><p><code>getScopeInfo</code> retrieves associated scope information:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ lrel[loc scope, value scopeInfo]  (ScopeRole scopeRole) getScopeInfo;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where</p><ul><li><code>scopeRole</code> is the role of the scope we are looking for.</li></ul><p><code>getScopeInfo</code> returns a list relation containing scope/scopeInfo pairs (ordered from innermost to outermost scope).</p><p>Let’s illustrate ScopeInfo with a stripped down version of how the Rascal type checker handles <code>while</code> and <code>break</code>
statements:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data LoopInfo = loopInfo(str name); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: (Statement) `&lt;Label label&gt; while( &lt;{Expression &quot;,&quot;}+ conditions&gt; ) &lt;Statement body&gt;`,  Collector c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c.enterScope(current);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        loopName = &quot;&lt;label.name&gt;&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        c.setScopeInfo(c.getScope(), loopScope(), loopInfo(loopName)); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c.leaveScope(current);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current:(Statement) `break &lt;Target target&gt;;`, Collector c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loopName = &quot;&lt;target.name&gt;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    for(&lt;scope, scopeInfo&gt; &lt;- c.getScopeInfo(loopScope())){ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if(loopInfo(loopName1) := scopeInfo){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if(loopName == &quot;&quot; || loopName == loopName1){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                collect(target, c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw rascalCheckerInternalError(getLoc(current), &quot;Inconsistent info from loop scope: &lt;scopeInfo&gt;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c.report(error(current, &quot;Break outside a while/do/for statement&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>Introduces a data type to represent loop information.</p></li><li><p>When handling a while statement, the current scope is marked as <code>loopScope</code> and <code>loopInfo</code> is associated with it.</p></li><li><p>When handling a <code>break</code> statement, we get all available ScopeInfo for loopScopes (innermost first) and check the
associated loopInfo.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="nested-info">Nested Info<a class="hash-link" href="#nested-info" title="Direct link to heading">​</a></h3><p>An arbitrary number of push down stacks can be maintained during the topdown traversal of the source code that is being
type checked. A use case is recording that a certain syntax type is encountered and make children aware of this, e.g.
&quot;we are inside a parameter list&quot;.</p><p>Each stack has a string name (<code>key</code>) and is created on demand.</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (str key, value val) push</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ value (str key) pop,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ value (str key) top,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ list[value] (str key) getStack,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (str key) clearStack,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>push</code>, <code>pop</code>, and <code>top</code> perform standard stack operations. <code>push</code> creates a stack when needed, while <code>top</code> and <code>pop</code>
require the existence of the named stack. <code>getStack</code> returns all values in the named stack, while <code>clearStack</code> resets it
to empty.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="composition">Composition<a class="hash-link" href="#composition" title="Direct link to heading">​</a></h3><p>TModels can be composed by adding the information from one TModel to the other. A use case is module compoisition.</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (TModel tm) addTModel;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>addTModel</code> adds the information in <code>tm</code> to the current Collector.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reporting-1">Reporting<a class="hash-link" href="#reporting-1" title="Direct link to heading">​</a></h3><p>One or more reports can be added by <code>report</code> and <code>reports</code>:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (FailMessage fmsg) report;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (list[FailMessage] fmgs) reports;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>See <a href="#TypePal-Reporting">Reporting</a> for a description of <code>FailMessage</code>.</p><blockquote><p><strong>Important</strong></p><p>If one of the messages is <code>error</code> the execution of the current calculator or requirement is immediately terminated.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-path">Add Path<a class="hash-link" href="#add-path" title="Direct link to heading">​</a></h3><p>TypePal is based on nested scopes and path between scopes. The former represent textual nesting as present in block
structure and function scopes. The latter represent non-local semantic links between program parts as present in import
statements between modules or Pascal’s with statement. The following functions add to the scope graph a path from the
current scope to another scope.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-a-path-to-a-definition">Add a path to a definition<a class="hash-link" href="#add-a-path-to-a-definition" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (Tree occ, set[IdRole] idRoles, PathRole pathRole) addPathToDef;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>addPathToDef</code> is typically used to create an <em>import</em> or <em>extend</em> path between program parts. <code>occ</code> is an occurence of
a name that should be defined elsewhere in one of the given roles. The effect is to add a <code>pathRole</code> path between the
current scope and the definition.</p><p>Here is an example taken from <a href="#_modfun">ModFun</a>:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: (ImportDecl) `import &lt;ModId mid&gt; ;`, Collector c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     c.addPathToDef(mid, {moduleId()}, importPath());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-a-path-to-a-qualified-definition">Add a path to a qualified definition<a class="hash-link" href="#add-a-path-to-a-qualified-definition" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (list[str] ids, Tree occ, set[IdRole] idRoles, set[IdRole] qualifierRoles, PathRole pathRole) addPathToQualifiedDef;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Similar to <code>addPathToDef</code> for the occurrence of a qualified names rather than a simple name.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-a-path-to-a-type">Add a path to a type<a class="hash-link" href="#add-a-path-to-a-type" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (Tree occ, PathRole pathRole) addPathToType</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>occ</code> is a parse tree with has a certain type. The effect is to add a <code>pathRole</code> path between the current scope and the
definition of that type.</p><p>A prime example is type checking of <a href="#_pascal">Pascal</a>&#x27;s <code>with</code> statement which <em>opens</em> the definition of a record type
and makes all defined fields available in the body of the <code>with</code> statement. Here we create a <code>withPath</code> between the
scope of the with statement and all definitions of the record types of the given record variables:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: (WithStatement) `with &lt;{RecordVariable &quot;,&quot;}+ recordVars&gt; do &lt;Statement withStat&gt;`, Collector c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c.enterScope(current);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for(rv &lt;- recordVars){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            c.addPathToType(rv, withPath());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        collect(recordVars, withStat, c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c.leaveScope(current);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="define">Define<a class="hash-link" href="#define" title="Direct link to heading">​</a></h3><p>The function <code>define</code> adds the definition of a name in the <em>current</em> scope:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */  void (str id, IdRole idRole, value def, DefInfo info) define;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where:</p><ul><li><p><code>id</code> is the textual appearance of the name.</p></li><li><p><code>idRole</code> is the role played by the name.</p></li><li><p><code>def</code> is the part of the parse tree that corresponds to the definition of the name.</p></li><li><p><code>info</code> is the definition information <a href="#_definfo">DefInfo</a> to be associated with this definition.</p></li></ul><p>The function <code>defineInScope</code> adds the definition of a name in a <em>given</em> scope:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */  void (value scope, str id, IdRole idRole, value def, DefInfo info) defineInScope</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use">Use<a class="hash-link" href="#use" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-an-unqualified-name">Use an unqualified name<a class="hash-link" href="#use-an-unqualified-name" title="Direct link to heading">​</a></h3><p>There are three functions to describe the occurrence of a name in a parse tree as a use. The most elementary use of a
name is described by:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (Tree occ, set[IdRole] idRoles) use,</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The parse tree <code>occ</code> is a use to be resolved in the current scope in one of the given roles <code>idRoles</code>. The use of a
variable in an expression is typically modelled with this use function.</p><p>Here is an example from <a href="#_calc">Calc</a>:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: (Exp) `&lt;Id name&gt;`, Collector c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c.use(name, {variableId()});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-a-qualified-name">Use a qualified name<a class="hash-link" href="#use-a-qualified-name" title="Direct link to heading">​</a></h3><p>Next we consider the use of qualified names, i.e., a list of identifiers that will be resolved from left to right. We
will call these identifiers (except the last one) <em>qualifiers</em> and the last one the <em>qualified identifier</em>.</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (list[str] ids, Tree occ, set[IdRole] idRoles, set[IdRole] qualifierRoles) useQualified;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here <code>ids</code> is the list of strings that form the qualified name, <code>occ</code> is the actual occurrence, and there are two sets
of roles: <code>idRoles</code> are the possible roles for the qualified identifier itself and <!-- -->`<!-- -->qualifierRoles are the possible
roles for the qualifiers.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="use-a-name-via-another-type">Use a name via another type<a class="hash-link" href="#use-a-name-via-another-type" title="Direct link to heading">​</a></h3><p>Many languages support <em>named types</em> and names that can be defined inside such a named type. Examples are field names in
records or method names in classes. <code>useViaType</code> handles the use of names defined in a named type:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (Tree container, Tree selector, set[IdRole] idRolesSel) useViaType</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where</p><ul><li><p><code>container</code>: has a named type as type.</p></li><li><p><code>selector</code>: is the name to be selected from that named type.</p></li><li><p><code>idRolesSel</code>: are the IdRoles allowed for the selector.</p></li></ul><p>Here is an example of field selection from a record in <a href="#_struct">Struct</a>:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current:(Expression)`&lt;Expression lhs&gt; . &lt;Id fieldName&gt;`, Collector c) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c.useViaType(lhs, fieldName, {fieldId()}); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c.fact(current, fieldName); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    collect(lhs, c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>Determine the type of <code>lhs</code>, say <em>T</em>. Now look for a definition of <code>fieldName</code> (as <code>fieldId</code>) in the definition of
<em>T</em>.</p></li><li><p>The type of the whole expressions becomes the type of <code>fieldId</code>.</p></li></ul><p><code>useViaType</code> can be configured with <a href="#_gettypenamesandrole">getTypeNamesAndRole</a> and
<a href="#_gettypeinnamelesstype">getTypeInNamelessType</a> that determine the precise mapping between a named or unnamed type and
its fields.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="uselub">UseLub<a class="hash-link" href="#uselub" title="Direct link to heading">​</a></h3><p>In some languages (think Rascal) local type inference and subtyping are needed to determine the type of variables: when
no explicit definition is present, the type of these variables is inferred from their use and the least-upper-bound
(LUB) of all the uses of a variable is taken as its type. <code>useLub</code> marks variable uses for which this regime has to be
applied:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (Tree occ, set[IdRole] idRoles) useLub</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>See the Rascal type checker for examples.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="inference">Inference<a class="hash-link" href="#inference" title="Direct link to heading">​</a></h3><p>ATypes may contain type variables and new type variables can be created using <code>newTypeVar</code>:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ AType (value src) newTypeVar;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Type variables can be bound via unification.</p><p>Here is an example of a call expression taken from <a href="#_untypedfun">UntypedFun</a>:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: (Expression) `&lt;Expression exp1&gt;(&lt;Expression exp2&gt;)`, Collector c) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     tau1 = c.newTypeVar(exp1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     tau2 = c.newTypeVar(exp2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     c.calculateEager(&quot;application&quot;, current, [exp1, exp2],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AType (Solver s) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              s.requireUnify(functionType(tau1, tau2), exp1, error(exp1, &quot;Function type expected, found %t&quot;, exp1));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              s.requireUnify(tau1, exp2, error(exp2, &quot;Incorrect type of actual parameter&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              return tau2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      collect(exp1, exp2, c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>calculate</code> and <code>require</code> are only evaluated when all their dependencies are available and they are fully instantiated,
i.e., <strong>do not contain type variables</strong>.</p><p><code>calculateEager</code> and <code>requireEager</code> are also only evaluated when all their dependencies are available <strong>but those may
contain type variables</strong>.</p><p>The bindings that are accumulated during <code>calculateEager</code> or <code>requireEager</code> are effectuated upon successfull completion
of that <code>calculateEager</code> or <code>requireEager</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fact">Fact<a class="hash-link" href="#fact" title="Direct link to heading">​</a></h3><p>The function <code>fact</code> registers known type information for a program fragment <code>src</code>:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (Tree src, value atype) fact;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where <code>atype</code> can be either an <code>AType</code> or a <code>Tree</code>. In the latter case the type of that Tree is used when available.</p><p>Here are two examples from <a href="#_calc">Calc</a>:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: (Exp) `&lt;Integer integer&gt;`, Collector c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c.fact(current, intType()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: (Exp) `( &lt;Exp e&gt; )`, Collector c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    c.fact(current, e);        </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    collect(e, c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>Registers the fact that the current expression has type <code>intType</code>.</p></li><li><p>Registers the fact that the current expression has the same type as the embedded expression <code>e</code>.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="calculate">Calculate<a class="hash-link" href="#calculate" title="Direct link to heading">​</a></h3><p>A calculator computes the type of a subtree <code>src</code> by way of an AType-returning function <code>calculator</code>. A list of
dependencies is given whose types have to be known before this calculator can be computed. There are two versions: for
<code>calculate</code> all dependencies should be fully resolved and instantiated, while <code>calculateEager</code> can also handle
dependencies that still contain type variables.</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (str name, Tree src, list[value] dependencies, AType(Solver s) calculator) calculate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (str name, Tree src, list[value] dependencies, AType(Solver s) calculator) calculateEager;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>See <a href="#TypePal-PocketCalculator">A Calculator Language</a> and <a href="#TypePal-Examples">Examples of Typecheckers</a> for examples of
calculator definitions.</p><p>See <a href="#_inference">Inference</a> for details about type variables.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="require">Require<a class="hash-link" href="#require" title="Direct link to heading">​</a></h3><p>A requirement is a predicate regarding the type or properties of a source tree fragment <code>src</code>. There are two versions:
for <code>require</code> all dependencies should be fully resolved and instantiated, while <code>requireEager</code> can also handle
dependencies that still contain type variables.</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (str name, Tree src, list[value] dependencies, void(Solver s) pred) require;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (str name, Tree src, list[value] dependencies, void(Solver s) pred) requireEager;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where</p><ul><li><p><code>name</code> is the name of the requirement (for reporting purposes).</p></li><li><p><code>dependencies</code> is a list of dependencies whose types have to be known before this requirement can be computed.</p></li><li><p><code>pred</code> is a function that actually checks the requirement; when it is violated this will be reported via its Solver
argument.</p></li></ul><p>More specific requiremens can be expressed for checking that two subtrees or types are equal, comparable, that the one
is a subtype of the other, or that they can be unified:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (value l, value r, FailMessage fmsg) requireEqual;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (value l, value r, FailMessage fmsg) requireComparable;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (value l, value r, FailMessage fmsg) requireSubType;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Collector field */ void (value l, value r, FailMessage fmsg) requireUnify;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The arguments <code>l</code> and <code>r</code> should either be an AType or a subtree whose type is known.</p><p>See <a href="#TypePal-PocketCalculator">A Calculator Language</a> and <a href="#TypePal-Examples">Examples of Typecheckers</a> for examples of
requirement definitions. See <a href="#_inference">Inference</a> for details about type variables.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="solver">Solver<a class="hash-link" href="#solver" title="Direct link to heading">​</a></h2><p><strong>Synopsis.</strong></p><p>A <code>Solver</code> tries to solve the constraints in a <code>TModel</code>; unsolved constraints produce error messages</p><p><strong>Description.</strong></p><p>The purpose of a Solver is to solve the constraints that have been gathered by the <a href="#TypePal-Collector">Collector</a> and
to produce a TModel. The functions provided by a Solver are summarized below:</p><p><img loading="lazy" alt="800" src="/assets/images/Solver-374c84ef6a85079567d8514546b1919b.png" width="605" height="448" class="img_ev3q"></p><p>Two dozen functions (some very similar to the ones provided for <a href="#TypePal-Collector">Collector</a>) are available that fall
into the following categories:</p><ul><li><p><em>Lifecycle of Solver</em>: create a new Solver and use it to solve the constraints in a given TModel.</p></li><li><p><em>Fact</em>: establish facts.</p></li><li><p><em>Calculate</em>: calculate types.</p></li><li><p><em>Require</em>: check requirements.</p></li><li><p><em>Types</em>: retrieve the type of a program fragment in various ways, if that type is available.</p></li><li><p><em>Inference</em>: create new type variables for type inference.</p></li><li><p><em>Reporting</em>: report errors, warnings and info messages.</p></li><li><p><em>Global Info</em>: access global information such as the current <a href="#TypePal-Configuration">TypePal Configuration</a>,
available type facts, and the global store (EXPLAIN).</p></li></ul><p>In identical style as used for <a href="#TypePal-Collector">Collector</a>, <code>Solver</code> is a datatype with a single constructur and
with a number of functions as fields, For instance, given a <code>Solver</code> named <code>s</code>, calling the <code>getType</code> function amounts
to: <code>s.getType(argument-of-getType)</code>. All Solver functions are prefixed with <code>/* Solver field */</code> to emphasize that they
are a field of the Solver datatype.</p><p>The result of the Solver is an enriched <code>TModel</code> that contains, amongst others, messages regarding violated requirements
or types that could not be computed. It can also be used to generate other usefull information about the program such as
a use-def relation and the used vocabulary (used for name completion).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="lifecycle-of-solver">Lifecycle of Solver<a class="hash-link" href="#lifecycle-of-solver" title="Direct link to heading">​</a></h3><p>Once, an initial TModel has been created by a <a href="#TypePal-Collector">Collector</a>, a Solver takes over to solve constraints
and produce a final TModel. A new Solver can be created by <code>newSolver</code> that comes in two flavours:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Solver newSolver(Tree pt, TModel tm)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Solver newSolver(map[str,Tree] namedTrees, TModel tm){</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The former takes a parse tree and an initial TModel and is intended to solve the constraints for a single parse tree.
The latter takes a map of named parse trees and an initial TModel and can handle the situation of multiple trees with
mutual dependencies.</p><p>Finally, <code>run</code> creates the final TModel by solving the constraints in the initial TModel:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ TModel () run</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A complete type checking scenario (for a given a parse tree <code>pt</code> of the program to be checked) is:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">c = newCollector(&quot;my_model&quot;, pt);  // create Collector</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">collect(pt, c);                    // collect constraints</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">initial_model = c.run();           // create initial TModel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">s = newSolver(pt, initial_model);  // create Solver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">final_model = s.run();             // solve constraints and produce final TModel</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The final TModel contains valuable information such as</p><ul><li><p>messages (errors, warnings, info);</p></li><li><p>type facts for subtrees of the given parse tree;</p></li><li><p>use/def relations.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fact-1">Fact<a class="hash-link" href="#fact-1" title="Direct link to heading">​</a></h3><p>The function <code>fact</code> registers known type information for a program fragment <code>src</code>:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ void (value src, AType atype) fact</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here</p><ul><li><p><code>src</code> may either be a <code>Tree</code> (i.e., a parse tree fragment) or a <code>loc</code> (the source location of a parse tree
fragment).</p></li><li><p><code>atype</code> is the AType to be associated with <code>src</code>.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="calculate-1">Calculate<a class="hash-link" href="#calculate-1" title="Direct link to heading">​</a></h3><p>All calculate (and require) functions use the following typing convention: an argument of type <code>value</code> can either be:</p><ul><li><p>an <code>AType</code>, or</p></li><li><p>a <code>Tree</code>.</p></li></ul><p>In the former case, the AType is used as is. In the latter case, the type of the tree is used provided that it exists.
Otherwise a <code>TypeUnavailable()</code> exception is generated and the calculator or requirement in which the predicate occurs
is re-evaluated at a later time.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="equal">equal<a class="hash-link" href="#equal" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ bool (value l, value r) equal</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The function <code>equal</code> determines whether the types of <code>l</code> and <code>r</code> are equal, the result is a Boolean value.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="subtype">subtype<a class="hash-link" href="#subtype" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ bool (value l, value r) subtype</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The function <code>subtype</code> determines whether the type of <code>l</code> is a subtype of the type of <code>r</code>; it calls the user-provided
function <code>getSubType</code>, see <a href="#TypePal-Configuration">TypePal Configuration</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="comparable">comparable<a class="hash-link" href="#comparable" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ bool (value l, value r) comparable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The function <code>comparable</code> determines whether the type of <code>l</code> is comparable with the type of <code>r</code>; it calls the
user-provided function <code>getSubType</code> twice, see <a href="#TypePal-Configuration">TypePal Configuration</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="unify">unify<a class="hash-link" href="#unify" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ bool (value l, value r) unify</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The function <code>unify</code> determines whether the type of <code>l</code> can be unified with the type of <code>r</code> it calls the user-provided
functions <code>getSubType</code> and <code>getLub</code>, see <a href="#TypePal-Configuration">TypePal Configuration</a>. The bindings that may result
from unification are effectuated when the enclosing calculate succeeds.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="lub">lub<a class="hash-link" href="#lub" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ AType (value l, value r) lub</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The function <code>lub</code> return the least upper bound of the types of <code>l</code> and <code>r</code>; it calls the user-provided function
<code>getLub</code>, see <a href="#TypePal-Configuration">TypePal Configuration</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="require-1">Require<a class="hash-link" href="#require-1" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="requireequal">requireEqual<a class="hash-link" href="#requireequal" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ void (value l, value r, FailMessage fmsg) requireEqual</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The function <code>requireEqual</code> returns when the types of <code>l</code> and <code>r</code> are equal, otherwise a FailMessage is reported.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="requiresubtype">requireSubType<a class="hash-link" href="#requiresubtype" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ void (value l, value r, FailMessage fmsg) requireSubType</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The function <code>requireSubtype</code> returns when the type of <code>l</code> is a subtype of <code>r</code>, otherwise the FailMessage is reported;
it calls the user-provided function <code>getSubType</code>, see <a href="#TypePal-Configuration">TypePal Configuration</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="requirecompare">requireCompare<a class="hash-link" href="#requirecompare" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ void (value l, value r, FailMessage fmsg) requireComparable</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The function <code>requireComparable</code> returns when the type of <code>l</code> is comparable with the type of <code>r</code>, otherwise the
FailMessage is generated; it calls the user-provided function <!-- -->`<!-- -->getSubType<!-- -->`<!-- -->twice, see <a href="#TypePal-Configuration">TypePal
Configuration</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="requireunify">requireUnify<a class="hash-link" href="#requireunify" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ void (value l, value r, FailMessage fmsg) requireUnify</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The function <code>requireUnify just returns when the type of `l</code> can be unified with the type of <code>r</code>, otherwise the
FailMessage is reported; it calls the user-provided functions <code>getSubType</code> and <code>getLub</code>, see <a href="#TypePal-Configuration">TypePal
Configuration</a>. The bindings that may result from unification are effectuated when the enclosing
require succeeds.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="requiretrue-and-requirefalse">requireTrue and requireFalse<a class="hash-link" href="#requiretrue-and-requirefalse" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ void (bool b, FailMessage fmsg) requireTrue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ void (bool b, FailMessage fmsg) requireFalse</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The function <code>requireTrue</code> returns when its condition is true, otherwise the FailMessage is reported. The function
<code>requireFalse</code> returns when its condition is false, otherwise the FailMessage is reported.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="types-1">Types<a class="hash-link" href="#types-1" title="Direct link to heading">​</a></h3><p>Type-related functions try to retrieve various forms of type information from parts of the source program. When that
information is available, it is returned as result. When it is not available, the internal exception <code>TypeUnavailable()</code>
is thrown. This will abort the execution of the current requirement or calculator which will then be tried later again.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gettype">getType<a class="hash-link" href="#gettype" title="Direct link to heading">​</a></h3><p>The workhorse of TypePal is the function <code>getType</code> that determines the type of a given source code fragment in the
current scope:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ AType(value src) getType</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>src</code> may either be a <code>Tree</code> (i.e., a parse tree fragment) or a <code>loc</code> (the source location of a parse tree fragment).</p><p>Here is how <code>getType</code> is used in <a href="#_pico">Pico</a> to check the addition operator:</p><ul><li><p>two integer arguments give an integer result;</p></li><li><p>two string arguments give a string result;</p></li><li><p>other combinations are incorrect.</p></li></ul><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void collect(current: (Expression) `&lt;Expression lhs&gt; + &lt;Expression rhs&gt;`, Collector c){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     c.calculate(&quot;addition&quot;, current, [lhs, rhs],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AType (Solver s) { switch([s.getType(lhs), s.getType(rhs)]){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   case [intType(), intType()]: return intType();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   case [strType(), strType()]: return strType();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   default:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       s.report(error(current, &quot;Operator `+` cannot be applied to %t and %t&quot;, lhs, rhs));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     collect(lhs, rhs, c);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gettypeinscope">getTypeInScope<a class="hash-link" href="#gettypeinscope" title="Direct link to heading">​</a></h3><p>The function <code>getTypeInScope</code> determines the type of a given source code fragment in a given scope and given roles:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ AType (Tree occ, loc scope, set[IdRole] idRoles) getTypeInScope</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here</p><ul><li><p><code>occ</code> is a parse tree fragment;</p></li><li><p><code>scope</code> is the desired scope;</p></li><li><p><code>idRoles</code> is a set of allowed identifier roles.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gettypeinscopefromname">getTypeInScopeFromName<a class="hash-link" href="#gettypeinscopefromname" title="Direct link to heading">​</a></h3><p>The function <code>getTypeInScopeFromName</code> determines the type of a given name that has been bound via given identifier roles
in a given scope. It is typically used to map a name of a type to its actual type, e.g., mapping the name <code>POINT</code> as it
occurs in a declaration to the actual record type of <code>POINT</code>.</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ AType (str name, loc scope, set[IdRole] idRoles) getTypeInScopeFromName</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here:</p><ul><li><p><code>name</code> is the name of the desired element;</p></li><li><p><code>scope</code> is the desired scope;</p></li><li><p><code>idRoles</code> is a set of allowed identifier roles.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gettypeintype">getTypeInType<a class="hash-link" href="#gettypeintype" title="Direct link to heading">​</a></h3><p>The function <code>getTypeInType</code> is typically used to determine parts of a container type such as, e.g., the fields in a
named record type or the methods in a named class type.</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ AType (AType containerType, Tree selector, set[IdRole] idRolesSel, loc scope) getTypeInType</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here:</p><ul><li><p><code>containerType</code> is a given container type;</p></li><li><p><code>selector</code> is a parse tree fragment to select a part from the container type (e.g., a field or method name);</p></li><li><p><code>idRolesSel</code> is a set of allowed identifier roles for the selector (e.g., <code>fieldId()</code> or <code>methodId()</code>);</p></li><li><p><code>scope</code> is the desired scope.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getalldefinedintype">getAllDefinedInType<a class="hash-link" href="#getalldefinedintype" title="Direct link to heading">​</a></h3><p>The function <code>getAllDefinedInType</code> is typically used to determine <strong>all</strong> named types that are defined in a container
type, e.g., all fields in a record type or all methods in a class type.</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ rel[str id, AType atype] (AType containerType, loc scope, set[IdRole] idRoles) getAllDefinedInType</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here:</p><ul><li><p><code>containerType</code> is a given container type;</p></li><li><p><code>scope</code> is the desired scope;</p></li><li><p><code>idRoles</code> is a set of allowed identifier roles for the selectoed types.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="inference-1">Inference<a class="hash-link" href="#inference-1" title="Direct link to heading">​</a></h3><p>Type inference is supported by the introduction of type variables using <code>newTypeVar</code> in combination with unification
primitives inside <code>calculateEager</code> <a href="#_calculate">Calculate</a> and <code>requireEager</code> <a href="#_require">Require</a> such as
<code>requireUnify</code> and <code>unify</code>. The following functions support the computation with types possibly containing type
variables.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="instantiate">instantiate<a class="hash-link" href="#instantiate" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ AType (AType atype) instantiate</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>replaces all type variables occurring in <code>atype</code> by their binding (when present).</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="isfullyinstantiated">isFullyInstantiated<a class="hash-link" href="#isfullyinstantiated" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ bool (AType atype) isFullyInstantiated</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>checks whether <code>atype</code> contains any occurrences of type variables.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reporting-2">Reporting<a class="hash-link" href="#reporting-2" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ bool(FailMessage fmsg) report</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ bool (list[FailMessage] fmsgs) reports</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="global-info">Global Info<a class="hash-link" href="#global-info" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getconfig">getConfig<a class="hash-link" href="#getconfig" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ TypePalConfig () getConfig</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Returns the current <a href="#TypePal-Configuration">TypePal Configuration</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getfacts">getFacts<a class="hash-link" href="#getfacts" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ map[loc, AType]() getFacts</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Returns the type facts known to the Solver as mapping from source location to AType.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getstore">getStore<a class="hash-link" href="#getstore" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Solver field */ map[str,value]() getStore</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Returns the global store of the Solver. The following elements may occur in the store:</p><ul><li>Remaining <a href="#_nested_info">Nested Info</a> from the collect phase. For instance, a single <code>push</code> to a stack during the
collect phase will be visible during the solve phase and can me (mis)used to communicate information between the two
phases.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="typepal-configuration">TypePal Configuration<a class="hash-link" href="#typepal-configuration" title="Direct link to heading">​</a></h2><p><strong>Synopsis.</strong></p><p>Configuration options for TypePal</p><p><strong>Description.</strong></p><p>TypePal provides configuration options for</p><ul><li><p><em>Name Resolution &amp; Overloading</em>: configures how names are resolved and which overloading is allowed.</p></li><li><p><em>Operations on Types</em>: configures how operations like subtype and least-upper-bound (lub) are defined.</p></li><li><p><em>Retrieval of Types</em>: configures how named and structured types are handled.</p></li><li><p><em>Extension Points</em>: configures operations before an after solving.</p></li><li><p><em>Miscellaneous</em>: utility functions that can be configured.</p></li><li><p><em>Verbosity</em>: configures the verbosity of TypePal.</p></li></ul><p>Here is an overview:</p><p><img loading="lazy" alt="600" src="/assets/images/TypePalConfig-d6a54ea28650ccf092176144eeea7b0b.png" width="539" height="321" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="name-resolution--overloading">Name Resolution &amp; Overloading<a class="hash-link" href="#name-resolution--overloading" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="isacceptablesimple">isAcceptableSimple<a class="hash-link" href="#isacceptablesimple" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */ Accept (TModel tm, loc def, Use use) isAcceptableSimple</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here</p><ul><li><p><code>tm</code> is a given TModel</p></li><li><p><code>def</code> is a proposed definition</p></li><li><p><code>use</code> is the use (characterized by the <code>Use</code> data type that contains, name, occurrence, scope and identifier roles
of the use, see <a href="#_identifier_use">Identifier Use</a>) for which the definition is proposed.</p></li></ul><p><code>isAcceptableSimple</code> accepts or rejects a proposed definition for the use of a simple name in a particular role. The
returned <code>Accept</code> data type is defined as:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data Accept</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    = acceptBinding()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | ignoreContinue()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    | ignoreSkipPath()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The default <code>isAcceptableSimple</code> returns acceptBinding()<!-- -->`<!-- -->.</p><p>Typical concerns addressed by <code>isAcceptableSimple</code> are:</p><ul><li><p>enforce definition before use;</p></li><li><p>check access rights, e.g. visibility.</p></li></ul><p>By comparing the offset of the source locations of definition, respectively, the use, we enforce definition before use:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Accept myIsAcceptableSimple(TModel tm, loc def, Use use)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    = use.occ.offset &gt; def.offset ? acceptBinding() : ignoreContinue();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="isacceptablequalified">isAcceptableQualified<a class="hash-link" href="#isacceptablequalified" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */ Accept (TModel tm, loc def, Use use) isAcceptableQualified</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here</p><ul><li><p><code>tm</code> is a given TModel</p></li><li><p><code>def</code> is a proposed definition</p></li><li><p><code>use</code> is the use for which the definition is proposed.</p></li></ul><p><code>isAcceptableQualified</code> accepts or rejects a proposed definition for the use of a qualified name in a particular role.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="isacceptablepath">isAcceptablePath<a class="hash-link" href="#isacceptablepath" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Accept (TModel tm, loc defScope, loc def, Use use, PathRole pathRole) isAcceptablePath</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here</p><ul><li><p><code>tm</code> is a given TModel;</p></li><li><p><code>defScope</code> is the scope in which the proposed definition occurs;</p></li><li><p><code>def</code> is a proposed definition;</p></li><li><p><code>use</code> is the use for which the definition is proposed;</p></li><li><p><code>pathRole</code> is the role of the semantic path.</p></li></ul><p><code>isAcceptablePath</code> accepts or rejects a proposed access path between use and definition.</p><p>To illustrate this, assume a language with modules and imports. A module may contain variable definitions but these are
not visible from outside the module. This can be enforced as follows:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Accept myIsAcceptablePath(TModel tm, loc def, Use use, PathRole pathRole) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return variableId() in use.idRoles ? ignoreContinue() : acceptBinding();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mayoverload">mayOverload<a class="hash-link" href="#mayoverload" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */ bool (set[loc] defs, map[loc, Define] defines) mayOverload</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>mayOverload</code> determines whether a set of definitions (<code>defs</code>) are allowed to be overloaded, given their definitions
(<code>defines</code>).</p><p>In <a href="#_fwjava">FWJava</a> the only allowed overloading is between class names and constructor names.</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bool fwjMayOverload (set[loc] defs, map[loc, Define] defines) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    roles = {defines[def].idRole | def &lt;- defs};  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return roles == {classId(), constructorId()}; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>First collect all the roles in which the overloaded names have been defined.</p></li><li><p>Only allow the combination of class name and constructor name.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="operations-on-types">Operations on Types<a class="hash-link" href="#operations-on-types" title="Direct link to heading">​</a></h3><p>Various operations on types can be configured by way of user-defined functions.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="issubtype">isSubType<a class="hash-link" href="#issubtype" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */ bool (AType l, AType r) isSubType</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Function that checks whether <code>l</code> is a subtype of <code>r</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getlub">getLub<a class="hash-link" href="#getlub" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */ AType (AType l, AType r) getLub</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Function that computes the least upperbound of two types and <code>l</code> and <code>r</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getminatype">getMinAType<a class="hash-link" href="#getminatype" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */ AType() getMinAType</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Function that returns the <em>smallest</em> type of the type lattice.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getmaxatype">getMaxAType<a class="hash-link" href="#getmaxatype" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */ AType() getMaxAType</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Function that returns the <em>largest</em> type of the type lattice.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="instantiatetypeparameters">instantiateTypeParameters<a class="hash-link" href="#instantiatetypeparameters" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */ AType (Tree current, AType def, AType ins, AType act, Solver s) instantiateTypeParameters</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The function <code>instantiateTypeParameters</code> defines instantiation of <strong>language-specific</strong> type parameters, where:</p><ul><li><p><code>current</code> is a source code fragment for which type <code>act</code> has already been determined, but any <strong>language-specific</strong>
type parameters in <code>act</code> may still need to be instantiated.</p></li><li><p><code>def</code> is the parameterized type of <code>act</code>.</p></li><li><p><code>ins</code> is an instantiated version of the type of <code>act</code> (i.e., with bound type parameters).</p></li><li><p><code>act</code> is the actual type found for <code>current</code> that needs to be instantiated.</p></li></ul><p><code>instantiateTypeParameters</code> will match <code>def</code> with <code>ins</code> and the resulting bindings will be used to instantiate <code>act</code>.
The instantiated version of <code>act</code> is returned.</p><p>In <a href="#_structparameters">StructParameters</a> parameterized structs (records) are defined. The formal type of such a struct
is <code>structDef(str name, list[str] formals)</code>, i.e., a struct has a name and a list of named formal type parameters. The
actual type of a struct is <code>structType(str name, list[AType] actuals)</code>, i.e., a struct name followed by actual types for
the parameters.</p><p>The definition of <code>instantiateTypeParameters</code> for this example is as follows:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">AType structParametersInstantiateTypeParameters(Tree current, structDef(str name1, list[str] formals), structType(str name2, list[AType] actuals), AType t, Solver s){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(size(formals) != size(actuals)) throw checkFailed([]);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bindings = (formals[i] : actuals [i] | int i &lt;- index(formals));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return visit(t) { case typeFormal(str x) =&gt; bindings[x] };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default AType structParametersInstantiateTypeParameters(Tree current, AType def, AType ins, AType act, Solver s) = act;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="retrieval-of-types">Retrieval of Types<a class="hash-link" href="#retrieval-of-types" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gettypenamesandrole">getTypeNamesAndRole<a class="hash-link" href="#gettypenamesandrole" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */  tuple[list[str] typeNames, set[IdRole] idRoles] (AType atype) getTypeNamesAndRole</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This function determines whether a given <code>atype</code> is a named type or not. This is needed for the customization of
indirect type computations such as <a href="#useViaType">???</a> and <a href="#_gettypeintype">getTypeInType</a>. When <code>atype</code> is a named type
<code>getTypeNamesAndRole</code> returns:</p><ul><li><p>A list of names that may be associated with it. In most languages this will contain just a single element, the name
of the type. In more sophisticated cases the list may contain a list of named types to be considered.</p></li><li><p>A list of roles in which the type name can be bound.</p></li></ul><p>Here are the definitions for \&lt;\&lt;Struct<!-- -->&gt;<!-- -->:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tuple[list[str] typeNames, set[IdRole] idRoles] structGetTypeNamesAndRole(structType(str name)){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return &lt;[name], {structId()}&gt;; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">default tuple[list[str] typeNames, set[IdRole] idRoles] structGetTypeNamesAndRole(AType t){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return &lt;[], {}&gt;;               </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><p>A <code>structType(name)</code> has a name that is bound in the role <code>structId()</code>. Return the name and role.</p></li><li><p>Any other type is unnamed; return an empty list of type names.</p></li></ul><p>Another example is the Rascal type checker, where we need to model the case that all abstract data types are a subtype
of <code>Tree</code>. In that case <code>getTypeNamesAndRole</code> will return <code>&lt;[&quot;A&quot;, &quot;Tree&quot;], roles&gt;</code> for an abstract data type <code>A</code>. The
net effect is that when the search for a name in <code>A</code> fails, the search is continued in <code>Tree</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gettypeintypefromdefine">getTypeInTypeFromDefine<a class="hash-link" href="#gettypeintypefromdefine" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */  AType (Define containerDef, str selectorName, set[IdRole] idRolesSel, Solver s) getTypeInTypeFromDefine</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In some extreme cases (think Rascal) the type of a field selection cannot be determined by considering all the fields
defined in a container type and as a last resort one needs to fall back to information that has been associated with the
original definition of the container type. <code>getTypeInTypeFromDefine</code> is called as a last resort from <code>getTypeInType</code>.</p><p>In the Rascal type checker common keyword parameters of data declarations are handled using <code>getTypeInTypeFromDefine</code>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gettypeinnamelesstype">getTypeInNamelessType<a class="hash-link" href="#gettypeinnamelesstype" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */ AType(AType containerType, Tree selector, loc scope, Solver s) getTypeInNamelessType</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>getTypeInNamelessType</code> describes field selection on built-types that have not been explicitly declared with a name. A
case in point is a <code>length</code> field on a built-in string type.</p><p>In <a href="#_staticfields">StaticFields</a> this is done as follows:</p><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">AType staticFieldsGetTypeInNamelessType(AType containerType, Tree selector, loc scope, Solver s){</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if(containerType == strType() &amp;&amp; &quot;&lt;selector&gt;&quot; == &quot;length&quot;) return intType();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    s.report(error(selector, &quot;Undefined field %q on %t&quot;, selector, containerType));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="extension-points">Extension Points<a class="hash-link" href="#extension-points" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="presolver">preSolver<a class="hash-link" href="#presolver" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */ TModel(map[str,Tree] namedTrees, TModel tm) preSolver</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A function <code>preSolver</code> that can enrich or transform the TModel before the Solver is applied to it.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="postsolver">postSolver<a class="hash-link" href="#postsolver" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */ void (map[str,Tree] namedTrees, Solver s) postSolver</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A function <code>postSolver</code> that can enrich or transform the TModel after constraint solving is complete.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="miscellaneous">Miscellaneous<a class="hash-link" href="#miscellaneous" title="Direct link to heading">​</a></h3><h3 class="anchor anchorWithStickyNavbar_LWe7" id="unescapename">unescapeName<a class="hash-link" href="#unescapename" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */  str(str) unescapeName</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A function <em>unescapeName</em> to define language-specific escape rules for names. By default, all backslashes are removed
from names.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="validateconstraints">validateConstraints<a class="hash-link" href="#validateconstraints" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */ bool validateConstraints = true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When <code>validateConstraints</code> is true, the validity of all constraints is checked before solving starts. For all
dependencies (in facts, calculators and requirements) a calculator needs to be present to solve that dependency.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="verbosity">Verbosity<a class="hash-link" href="#verbosity" title="Direct link to heading">​</a></h3><p>The verbosity of TypePal can be controlled with several configurations settings.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="showtimes">showTimes<a class="hash-link" href="#showtimes" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */ bool showTimes = false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When <code>showTimes</code> is true, the time of the Collector and Solver phases is printed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="showsolversteps">showSolverSteps<a class="hash-link" href="#showsolversteps" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */ bool showSolverSteps = false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When <code>showSolverSteps</code> is true, each step of the Solver is printed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="showsolveriterations">showSolverIterations<a class="hash-link" href="#showsolveriterations" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */ bool showSolverIterations = false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When <code>showSolverIterations</code> is true, information is printed about each iteration of the Solver.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="showattempts">showAttempts<a class="hash-link" href="#showattempts" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */ bool showAttempts = false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When <code>showAttempts</code> is true, the number of evaluation attempts per calculator or requirement is printed when solving is
complete.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="showtmodel">showTModel<a class="hash-link" href="#showtmodel" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/* Configuration field */ bool showTModel = false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When <code>showTModel</code> is true, the resulting TModel is printed when solving is complete.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="utilities">Utilities<a class="hash-link" href="#utilities" title="Direct link to heading">​</a></h2><p><strong>Synopsis.</strong></p><p>Some utility functions.</p><p><strong>Description.</strong></p><p>TypePal provides some utility functions to address common scenarios.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="collectandsolve">collectAndSolve<a class="hash-link" href="#collectandsolve" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TModel collectAndSolve(Tree pt, TypePalConfig config = tconfig(), bool debug = false)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>collectAndSolve</code> implements the most simple type checking scenario without any customization. For a given parse tree
<code>pt</code>:</p><ul><li><p>Create a Collector and use it to create a TModel by applying <code>collect</code> to parse tree <code>pt</code>.</p></li><li><p>Create a Solver and solve the constraints in that TModel.</p></li><li><p>Return the extended TModel.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getusedef">getUseDef<a class="hash-link" href="#getusedef" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rel[loc, loc] getUseDef(TModel tm)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Get all use-def relations in a given TModel. This may be used in an IDE for creating hyperlinks between use locations
and definitions.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getvocabulary">getVocabulary<a class="hash-link" href="#getvocabulary" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">set[str] getVocabulary(TModel tm)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Get all defined names in a given TModel. This may be used in an IDE for text completion.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getfacts-1">getFacts<a class="hash-link" href="#getfacts-1" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">map[loc, AType] getFacts(TModel tm)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Get all the locations and their type in a given TModel.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getmessages">getMessages<a class="hash-link" href="#getmessages" title="Direct link to heading">​</a></h3><div class="language-rascal codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rascal codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">list[Message] getMessages(TModel tm)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Get all the messages in a TModel (as added by the Solver).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="examples-of-typecheckers">Examples of Typecheckers<a class="hash-link" href="#examples-of-typecheckers" title="Direct link to heading">​</a></h2><p><strong>Synopsis.</strong></p><p>Examples of type checkers built with TypePal.</p><p><strong>Description.</strong></p><p>TypePal is used in a new type checker for the Rascal meta-programming language and also in type checkers for half a
dozen domain-specific languages created by <a href="http://swat.engineering" target="_blank" rel="noopener noreferrer">http://swat.engineering</a> in the domains finance, forensics and privacy.</p><p>To get you started more quickly, we give below a list of complete TypePal-based type checkers ranging from very simple
(intended only to illustrate specific TypePal features) to type checkers for FeatherweightJava and the complete Pascal
programming language. For each example we give a description, the most distinctive TypePal features that are used, and
its source at GitHub. Each example has the same structure:</p><ul><li><p><code>Syntax.rsc</code> the syntax of the example language.</p></li><li><p><code>Checker.rsc</code> the type checker for the language.</p></li><li><p><code>Test.rsc</code> functions to call the type checker and test framework.</p></li><li><p><code>tests.ttl</code> test cases for the type checker.</p></li><li><p><code>examples</code> (optionally) a directory with example.</p></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="calc">Calc<a class="hash-link" href="#calc" title="Direct link to heading">​</a></h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>What</strong></td><td>The pocket calculator language Calc; we already covered it <a href="#A%20simple%20pocket%20calculator%20language">???</a></td></tr><tr><td><strong>Illustrates</strong></td><td>fact, define, use, requireEqual, calculate, getType, report</td></tr><tr><td><strong>Source</strong></td><td><a href="https://github.com/cwi-swat/typepal/tree/master/src/examples/calc" target="_blank" rel="noopener noreferrer">https://github.com/cwi-swat/typepal/tree/master/src/examples/calc</a></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pico">Pico<a class="hash-link" href="#pico" title="Direct link to heading">​</a></h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>What</strong></td><td>Toy language with declared variables in single scope, assignment, if and while statement</td></tr><tr><td><strong>Illustrates</strong></td><td>fact, define, use, enterScope, leaveScope, requireEqual, calculate, getType, report</td></tr><tr><td><strong>Source</strong></td><td><a href="https://github.com/cwi-swat/typepal/tree/master/src/examples/pico" target="_blank" rel="noopener noreferrer">https://github.com/cwi-swat/typepal/tree/master/src/examples/pico</a></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ql">QL<a class="hash-link" href="#ql" title="Direct link to heading">​</a></h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>What</strong></td><td>A questionnaire language, for describing forms with text entry fields and computed values</td></tr><tr><td><strong>Illustrates</strong></td><td>fact, define, use, requireEqual, requireTrue, calculate, getType, report</td></tr><tr><td><strong>Source</strong></td><td><a href="https://github.com/cwi-swat/typepal/tree/master/src/examples/ql" target="_blank" rel="noopener noreferrer">https://github.com/cwi-swat/typepal/tree/master/src/examples/ql</a></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fun">Fun<a class="hash-link" href="#fun" title="Direct link to heading">​</a></h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>What</strong></td><td>Functional language with explicit types, function declarations and calls, let and if expressions</td></tr><tr><td><strong>Illustrates</strong></td><td>fact, define, use, enterScope, leaveScope, requireEqual, calculate, getType, report</td></tr><tr><td><strong>Source</strong></td><td><a href="https://github.com/cwi-swat/typepal/tree/master/src/examples/fun" target="_blank" rel="noopener noreferrer">https://github.com/cwi-swat/typepal/tree/master/src/examples/fun</a></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="modfun">ModFun<a class="hash-link" href="#modfun" title="Direct link to heading">​</a></h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>What</strong></td><td>Extension of <a href="#_fun">Fun</a> with modules</td></tr><tr><td><strong>Illustrates</strong></td><td>PathRole, addPathToDef</td></tr><tr><td><strong>Source</strong></td><td><a href="https://github.com/cwi-swat/typepal/tree/master/src/examples/modfun" target="_blank" rel="noopener noreferrer">https://github.com/cwi-swat/typepal/tree/master/src/examples/modfun</a></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="struct">Struct<a class="hash-link" href="#struct" title="Direct link to heading">​</a></h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>What</strong></td><td>Simple named records</td></tr><tr><td><strong>Illustrates</strong></td><td>useViaType, TypePalConfig, getTypeNamesAndRole</td></tr><tr><td><strong>Source</strong></td><td><a href="https://github.com/cwi-swat/typepal/tree/master/src/examples/struct" target="_blank" rel="noopener noreferrer">https://github.com/cwi-swat/typepal/tree/master/src/examples/struct</a></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="aliases">Aliases<a class="hash-link" href="#aliases" title="Direct link to heading">​</a></h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>What</strong></td><td><a href="#_struct">Struct</a> extended with type aliases</td></tr><tr><td><strong>Illustrates</strong></td><td>useViaType, TypePalConfig, getTypeNamesAndRole</td></tr><tr><td><strong>Source</strong></td><td><a href="https://github.com/cwi-swat/typepal/tree/master/src/examples/aliases" target="_blank" rel="noopener noreferrer">https://github.com/cwi-swat/typepal/tree/master/src/examples/aliases</a></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="staticfields">StaticFields<a class="hash-link" href="#staticfields" title="Direct link to heading">​</a></h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>What</strong></td><td><a href="#_struct">Struct</a> extended with fields on non-record type</td></tr><tr><td><strong>Illustrates</strong></td><td>useViaType, TypePalConfig, getTypeNamesAndRole, getTypeInNamelessType</td></tr><tr><td><strong>Source</strong></td><td><a href="https://github.com/cwi-swat/typepal/tree/master/src/examples/staticFields" target="_blank" rel="noopener noreferrer">https://github.com/cwi-swat/typepal/tree/master/src/examples/staticFields</a></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="structparameters">StructParameters<a class="hash-link" href="#structparameters" title="Direct link to heading">​</a></h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>What</strong></td><td><a href="#_struct">Struct</a> with parameterized records</td></tr><tr><td><strong>Illustrates</strong></td><td>useViaType, TypePalConfig, getTypeNamesAndRole, getTypeInNamelessType, instantiateTypeParameters</td></tr><tr><td><strong>Source</strong></td><td><a href="https://github.com/cwi-swat/typepal/tree/master/src/examples/structParameters" target="_blank" rel="noopener noreferrer">https://github.com/cwi-swat/typepal/tree/master/src/examples/structParameters</a></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="smalloo">SmallOO<a class="hash-link" href="#smalloo" title="Direct link to heading">​</a></h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>What</strong></td><td>Small OO language without inheritance</td></tr><tr><td><strong>Illustrates</strong></td><td>useViaType, TypePalConfig, getTypeNamesAndRole</td></tr><tr><td><strong>Source</strong></td><td><a href="https://github.com/cwi-swat/typepal/tree/master/src/examples/smallOO" target="_blank" rel="noopener noreferrer">https://github.com/cwi-swat/typepal/tree/master/src/examples/smallOO</a></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fwjava">FWJava<a class="hash-link" href="#fwjava" title="Direct link to heading">​</a></h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>What</strong></td><td>FeatherWeight Java, a minimal, Java-like, language with inheritance and constructors</td></tr><tr><td><strong>Illustrates</strong></td><td>useViaType, addPathToDef, isSubType, TypePalConfig, getTypeNamesAndRole, mayOverload, preSolver, setScopeInfo, getScopeInfo</td></tr><tr><td><strong>Source</strong></td><td><a href="https://github.com/cwi-swat/typepal/tree/master/src/examples/fwjava" target="_blank" rel="noopener noreferrer">https://github.com/cwi-swat/typepal/tree/master/src/examples/fwjava</a></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pascal">Pascal<a class="hash-link" href="#pascal" title="Direct link to heading">​</a></h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>What</strong></td><td>The Pascal language (Second Edition, 1978)</td></tr><tr><td><strong>Illustrates</strong></td><td>useViaType, addPathToType, PathRole, isSubType, TypePalConfig, preCollectInitialization getTypeNamesAndRole</td></tr><tr><td><strong>Source</strong></td><td><a href="https://github.com/cwi-swat/typepal/tree/master/src/examples/pascal" target="_blank" rel="noopener noreferrer">https://github.com/cwi-swat/typepal/tree/master/src/examples/pascal</a></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="untypedfun">UntypedFun<a class="hash-link" href="#untypedfun" title="Direct link to heading">​</a></h3><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>What</strong></td><td>Functional language with implicit (inferred) types, function declarations and calls, let and if expressions</td></tr><tr><td><strong>Illustrates</strong></td><td>fact, define, use, enterScope, leaveScope, requireEqual, calculate, getType, report, newTypeVar, calculateEager, requireUnify, unify</td></tr><tr><td><strong>Source</strong></td><td><a href="https://github.com/cwi-swat/typepal/tree/master/src/examples/untypedFun" target="_blank" rel="noopener noreferrer">https://github.com/cwi-swat/typepal/tree/master/src/examples/untypedFun</a></td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/usethesource/rascal-website/tree/website-v2/docs/docs/TypePal.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/RascalShell"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Rascal Shell</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/RunTimeErrors"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Runtime Errors</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#a-calculator-language" class="table-of-contents__link toc-highlight">A Calculator Language</a><ul><li><a href="#syntax-of-calc" class="table-of-contents__link toc-highlight">Syntax of Calc</a></li><li><a href="#typechecking-calc" class="table-of-contents__link toc-highlight">Typechecking Calc</a></li><li><a href="#begin-of-type-checker-module-for-calc" class="table-of-contents__link toc-highlight">Begin of type checker module for Calc</a></li><li><a href="#extend-atype" class="table-of-contents__link toc-highlight">Extend AType</a></li><li><a href="#collecting-facts-and-constraints" class="table-of-contents__link toc-highlight">Collecting facts and constraints</a></li><li><a href="#testing-the-calc-typechecker" class="table-of-contents__link toc-highlight">Testing the Calc typechecker</a></li><li><a href="#getting-started" class="table-of-contents__link toc-highlight">Getting started</a></li><li><a href="#manual-testing" class="table-of-contents__link toc-highlight">Manual testing</a></li><li><a href="#automated-testing" class="table-of-contents__link toc-highlight">Automated testing</a></li></ul></li><li><a href="#concepts-and-definitions" class="table-of-contents__link toc-highlight">Concepts and Definitions</a><ul><li><a href="#identifier" class="table-of-contents__link toc-highlight">Identifier</a></li><li><a href="#tree" class="table-of-contents__link toc-highlight">Tree</a></li><li><a href="#scope" class="table-of-contents__link toc-highlight">Scope</a></li><li><a href="#scope-graph" class="table-of-contents__link toc-highlight">Scope Graph</a></li><li><a href="#identifier-definition" class="table-of-contents__link toc-highlight">Identifier definition</a></li><li><a href="#identifier-use" class="table-of-contents__link toc-highlight">Identifier Use</a></li><li><a href="#path" class="table-of-contents__link toc-highlight">Path</a></li><li><a href="#name-resolution" class="table-of-contents__link toc-highlight">Name Resolution</a></li><li><a href="#role" class="table-of-contents__link toc-highlight">Role</a></li><li><a href="#identifier-role" class="table-of-contents__link toc-highlight">Identifier Role</a></li><li><a href="#scope-role" class="table-of-contents__link toc-highlight">Scope Role</a></li><li><a href="#path-role" class="table-of-contents__link toc-highlight">Path Role</a></li><li><a href="#types" class="table-of-contents__link toc-highlight">Types</a></li><li><a href="#definfo" class="table-of-contents__link toc-highlight">DefInfo</a></li></ul></li><li><a href="#architecture-of-typepal" class="table-of-contents__link toc-highlight">Architecture of TypePal</a></li><li><a href="#reporting" class="table-of-contents__link toc-highlight">Reporting</a></li><li><a href="#collector" class="table-of-contents__link toc-highlight">Collector</a><ul><li><a href="#lifecycle-of-collector" class="table-of-contents__link toc-highlight">LifeCycle of Collector</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li><li><a href="#scoping" class="table-of-contents__link toc-highlight">Scoping</a></li><li><a href="#scope-info" class="table-of-contents__link toc-highlight">Scope Info</a></li><li><a href="#nested-info" class="table-of-contents__link toc-highlight">Nested Info</a></li><li><a href="#composition" class="table-of-contents__link toc-highlight">Composition</a></li><li><a href="#reporting-1" class="table-of-contents__link toc-highlight">Reporting</a></li><li><a href="#add-path" class="table-of-contents__link toc-highlight">Add Path</a></li><li><a href="#add-a-path-to-a-definition" class="table-of-contents__link toc-highlight">Add a path to a definition</a></li><li><a href="#add-a-path-to-a-qualified-definition" class="table-of-contents__link toc-highlight">Add a path to a qualified definition</a></li><li><a href="#add-a-path-to-a-type" class="table-of-contents__link toc-highlight">Add a path to a type</a></li><li><a href="#define" class="table-of-contents__link toc-highlight">Define</a></li><li><a href="#use" class="table-of-contents__link toc-highlight">Use</a></li><li><a href="#use-an-unqualified-name" class="table-of-contents__link toc-highlight">Use an unqualified name</a></li><li><a href="#use-a-qualified-name" class="table-of-contents__link toc-highlight">Use a qualified name</a></li><li><a href="#use-a-name-via-another-type" class="table-of-contents__link toc-highlight">Use a name via another type</a></li><li><a href="#uselub" class="table-of-contents__link toc-highlight">UseLub</a></li><li><a href="#inference" class="table-of-contents__link toc-highlight">Inference</a></li><li><a href="#fact" class="table-of-contents__link toc-highlight">Fact</a></li><li><a href="#calculate" class="table-of-contents__link toc-highlight">Calculate</a></li><li><a href="#require" class="table-of-contents__link toc-highlight">Require</a></li></ul></li><li><a href="#solver" class="table-of-contents__link toc-highlight">Solver</a><ul><li><a href="#lifecycle-of-solver" class="table-of-contents__link toc-highlight">Lifecycle of Solver</a></li><li><a href="#fact-1" class="table-of-contents__link toc-highlight">Fact</a></li><li><a href="#calculate-1" class="table-of-contents__link toc-highlight">Calculate</a></li><li><a href="#equal" class="table-of-contents__link toc-highlight">equal</a></li><li><a href="#subtype" class="table-of-contents__link toc-highlight">subtype</a></li><li><a href="#comparable" class="table-of-contents__link toc-highlight">comparable</a></li><li><a href="#unify" class="table-of-contents__link toc-highlight">unify</a></li><li><a href="#lub" class="table-of-contents__link toc-highlight">lub</a></li><li><a href="#require-1" class="table-of-contents__link toc-highlight">Require</a></li><li><a href="#requireequal" class="table-of-contents__link toc-highlight">requireEqual</a></li><li><a href="#requiresubtype" class="table-of-contents__link toc-highlight">requireSubType</a></li><li><a href="#requirecompare" class="table-of-contents__link toc-highlight">requireCompare</a></li><li><a href="#requireunify" class="table-of-contents__link toc-highlight">requireUnify</a></li><li><a href="#requiretrue-and-requirefalse" class="table-of-contents__link toc-highlight">requireTrue and requireFalse</a></li><li><a href="#types-1" class="table-of-contents__link toc-highlight">Types</a></li><li><a href="#gettype" class="table-of-contents__link toc-highlight">getType</a></li><li><a href="#gettypeinscope" class="table-of-contents__link toc-highlight">getTypeInScope</a></li><li><a href="#gettypeinscopefromname" class="table-of-contents__link toc-highlight">getTypeInScopeFromName</a></li><li><a href="#gettypeintype" class="table-of-contents__link toc-highlight">getTypeInType</a></li><li><a href="#getalldefinedintype" class="table-of-contents__link toc-highlight">getAllDefinedInType</a></li><li><a href="#inference-1" class="table-of-contents__link toc-highlight">Inference</a></li><li><a href="#instantiate" class="table-of-contents__link toc-highlight">instantiate</a></li><li><a href="#isfullyinstantiated" class="table-of-contents__link toc-highlight">isFullyInstantiated</a></li><li><a href="#reporting-2" class="table-of-contents__link toc-highlight">Reporting</a></li><li><a href="#global-info" class="table-of-contents__link toc-highlight">Global Info</a></li><li><a href="#getconfig" class="table-of-contents__link toc-highlight">getConfig</a></li><li><a href="#getfacts" class="table-of-contents__link toc-highlight">getFacts</a></li><li><a href="#getstore" class="table-of-contents__link toc-highlight">getStore</a></li></ul></li><li><a href="#typepal-configuration" class="table-of-contents__link toc-highlight">TypePal Configuration</a><ul><li><a href="#name-resolution--overloading" class="table-of-contents__link toc-highlight">Name Resolution &amp; Overloading</a></li><li><a href="#isacceptablesimple" class="table-of-contents__link toc-highlight">isAcceptableSimple</a></li><li><a href="#isacceptablequalified" class="table-of-contents__link toc-highlight">isAcceptableQualified</a></li><li><a href="#isacceptablepath" class="table-of-contents__link toc-highlight">isAcceptablePath</a></li><li><a href="#mayoverload" class="table-of-contents__link toc-highlight">mayOverload</a></li><li><a href="#operations-on-types" class="table-of-contents__link toc-highlight">Operations on Types</a></li><li><a href="#issubtype" class="table-of-contents__link toc-highlight">isSubType</a></li><li><a href="#getlub" class="table-of-contents__link toc-highlight">getLub</a></li><li><a href="#getminatype" class="table-of-contents__link toc-highlight">getMinAType</a></li><li><a href="#getmaxatype" class="table-of-contents__link toc-highlight">getMaxAType</a></li><li><a href="#instantiatetypeparameters" class="table-of-contents__link toc-highlight">instantiateTypeParameters</a></li><li><a href="#retrieval-of-types" class="table-of-contents__link toc-highlight">Retrieval of Types</a></li><li><a href="#gettypenamesandrole" class="table-of-contents__link toc-highlight">getTypeNamesAndRole</a></li><li><a href="#gettypeintypefromdefine" class="table-of-contents__link toc-highlight">getTypeInTypeFromDefine</a></li><li><a href="#gettypeinnamelesstype" class="table-of-contents__link toc-highlight">getTypeInNamelessType</a></li><li><a href="#extension-points" class="table-of-contents__link toc-highlight">Extension Points</a></li><li><a href="#presolver" class="table-of-contents__link toc-highlight">preSolver</a></li><li><a href="#postsolver" class="table-of-contents__link toc-highlight">postSolver</a></li><li><a href="#miscellaneous" class="table-of-contents__link toc-highlight">Miscellaneous</a></li><li><a href="#unescapename" class="table-of-contents__link toc-highlight">unescapeName</a></li><li><a href="#validateconstraints" class="table-of-contents__link toc-highlight">validateConstraints</a></li><li><a href="#verbosity" class="table-of-contents__link toc-highlight">Verbosity</a></li><li><a href="#showtimes" class="table-of-contents__link toc-highlight">showTimes</a></li><li><a href="#showsolversteps" class="table-of-contents__link toc-highlight">showSolverSteps</a></li><li><a href="#showsolveriterations" class="table-of-contents__link toc-highlight">showSolverIterations</a></li><li><a href="#showattempts" class="table-of-contents__link toc-highlight">showAttempts</a></li><li><a href="#showtmodel" class="table-of-contents__link toc-highlight">showTModel</a></li></ul></li><li><a href="#utilities" class="table-of-contents__link toc-highlight">Utilities</a><ul><li><a href="#collectandsolve" class="table-of-contents__link toc-highlight">collectAndSolve</a></li><li><a href="#getusedef" class="table-of-contents__link toc-highlight">getUseDef</a></li><li><a href="#getvocabulary" class="table-of-contents__link toc-highlight">getVocabulary</a></li><li><a href="#getfacts-1" class="table-of-contents__link toc-highlight">getFacts</a></li><li><a href="#getmessages" class="table-of-contents__link toc-highlight">getMessages</a></li></ul></li><li><a href="#examples-of-typecheckers" class="table-of-contents__link toc-highlight">Examples of Typecheckers</a><ul><li><a href="#calc" class="table-of-contents__link toc-highlight">Calc</a></li><li><a href="#pico" class="table-of-contents__link toc-highlight">Pico</a></li><li><a href="#ql" class="table-of-contents__link toc-highlight">QL</a></li><li><a href="#fun" class="table-of-contents__link toc-highlight">Fun</a></li><li><a href="#modfun" class="table-of-contents__link toc-highlight">ModFun</a></li><li><a href="#struct" class="table-of-contents__link toc-highlight">Struct</a></li><li><a href="#aliases" class="table-of-contents__link toc-highlight">Aliases</a></li><li><a href="#staticfields" class="table-of-contents__link toc-highlight">StaticFields</a></li><li><a href="#structparameters" class="table-of-contents__link toc-highlight">StructParameters</a></li><li><a href="#smalloo" class="table-of-contents__link toc-highlight">SmallOO</a></li><li><a href="#fwjava" class="table-of-contents__link toc-highlight">FWJava</a></li><li><a href="#pascal" class="table-of-contents__link toc-highlight">Pascal</a></li><li><a href="#untypedfun" class="table-of-contents__link toc-highlight">UntypedFun</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/GettingStarted">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/rascal" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/usethesource" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 UseTheSource. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3f32e7f3.js"></script>
<script src="/assets/js/main.ea59d2f2.js"></script>
</body>
</html>