<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Optimizing Hash Tries | The Rascal Meta Programming Language</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://rascal-mpl.org/blog/2015/10/30/optimizing-hash-tries/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Optimizing Hash Tries | The Rascal Meta Programming Language"><meta data-rh="true" name="description" content="Hash-tries are the data-structure under Rascal&#x27;s sets, maps and relations. These papers explain how they work and how we make them lean and fast on the JVM. Others have blogged about these results as well. The code can be found in the Capsule project."><meta data-rh="true" property="og:description" content="Hash-tries are the data-structure under Rascal&#x27;s sets, maps and relations. These papers explain how they work and how we make them lean and fast on the JVM. Others have blogged about these results as well. The code can be found in the Capsule project."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2015-10-30T00:00:00.000Z"><meta data-rh="true" property="article:author" content="http://homepages.cwi.nl/~jurgenv"><link data-rh="true" rel="icon" href="/images/favicon.ico"><link data-rh="true" rel="canonical" href="https://rascal-mpl.org/blog/2015/10/30/optimizing-hash-tries/"><link data-rh="true" rel="alternate" href="https://rascal-mpl.org/blog/2015/10/30/optimizing-hash-tries/" hreflang="en"><link data-rh="true" rel="alternate" href="https://rascal-mpl.org/blog/2015/10/30/optimizing-hash-tries/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://FKSZQR9CR0-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="The Rascal Meta Programming Language RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="The Rascal Meta Programming Language Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="The Rascal Meta Programming Language" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/release-notes/rss.xml" title="The Rascal Meta Programming Language RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/release-notes/atom.xml" title="The Rascal Meta Programming Language Atom Feed"><link rel="stylesheet" href="/assets/css/styles.d1b9a24b.css">
<link rel="preload" href="/assets/js/runtime~main.d9e49a94.js" as="script">
<link rel="preload" href="/assets/js/main.c7515b01.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/images/rascal_large_no_text.png" alt="Rascal logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/images/rascal_large_no_text.png" alt="Rascal logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">The Rascal Meta Programming Language</b></a><a class="navbar__item navbar__link" href="/docs/GettingStarted/">Docs</a><a class="navbar__item navbar__link" href="/stories/">Stories</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a><a class="navbar__item navbar__link" href="/release-notes/">Release notes</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/projects/">Projects</a><a class="navbar__item navbar__link" href="/team/">Team</a><a href="https://github.com/usethesource" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2017/03/01/what-is-vallang/">What is ValLang?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/05/16/navigating-the-wordpress-plugin-landscape/">Navigating the WordPress Plugin Landscape</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/03/12/performance-modeling-of-maximal-sharing/">Performance Modeling of Maximal Sharing - Experience Report</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2016/01/01/empirical-analysis-of-the-relationship-between-CC-and-SLOC/">Empirical analysis of the relationship between CC and SLOC</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/2015/10/30/optimizing-hash-tries/">Optimizing Hash Tries</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2015/03/02/from-imperative-to-functional/">From imperative programming to functional programming</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2013/08/02/the-language-interaction-design-of-concrete-syntax/">The Language Interaction Design of Concrete Syntax</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2013/07/29/dsl-in-36-lines-of-code/">A DSL in 36 lines of code</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2013/05/15/from-functions-to-term-rewriting-and-back/">From functions to term rewriting and back in Rascal</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Optimizing Hash Tries</h1><div class="container_mt6G margin-vert--md"><time datetime="2015-10-30T00:00:00.000Z" itemprop="datePublished">October 30, 2015</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="http://homepages.cwi.nl/~jurgenv" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://www.cwi.nl/news/2014/jurgen-vinju-appointed-professor/@@images/5e1fe43d-a00b-4989-a5b9-eb526725c6ee.jpeg" alt="Jurgen Vinju"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="http://homepages.cwi.nl/~jurgenv" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Jurgen Vinju</span></a></div><small class="avatar__subtitle" itemprop="description">Groupleader @ CWI-SWAT, professor @ TU/E, Rascal Core Team</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>Hash-tries are the data-structure under Rascal&#x27;s sets, maps and relations. These papers explain how they work and how we make them lean and fast on the JVM. <a href="https://blog.acolyer.org/2015/11/27/hamt/" target="_blank" rel="noopener noreferrer">Others</a> have blogged about these results as well. The code can be found in the <a href="http://www.usethesource.io/projects/capsule" target="_blank" rel="noopener noreferrer">Capsule project</a>.</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">@inproceedings{oopsla2015,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  title = {Optimizing Hash-Array Mapped Tries for Fast and Lean Immutable JVM Collections}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  author = {Michael Steindorder and Jurgen J. Vinju}.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  year = 2015,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  booktitle = {Proceedings of the Annual ACM SIGPLAN Conference on Object-Oriented Programming, Systems, Languages, and Applications (OOPSLA)},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  editor = {Patrick Eugster},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fulltext = &quot;http://michael.steindorfer.name/publications/oopsla15.pdf&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@inproceedings{gpce14,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> author = {Steindorfer, Michael J. and Vinju, Jurgen J.},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> title = {Code Specialization for Memory Efficient Hash Tries},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> booktitle = {Proceedings of the 2014 International Conference on Generative Programming: Concepts and Experiences},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> series = {GPCE 2014},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> year = {2014},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> pages = {11--14},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> numpages = {4},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> doi = {10.1145/2658761.2658763},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> publisher = {ACM},</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> fulltext = &quot;http://michael.steindorfer.name/publications/gpce14.pdf&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The data structures under-pinning collection API (e.g. lists, sets, maps) in the standard libraries of programming languages are used intensively in many applications. The standard libraries of recent Java Virtual Machine languages, such as Clojure or Scala, contain scalable and well-performing immutable collection data structures that are implemented as Hash-Array Mapped Tries (HAMTs). HAMTs already feature efficient lookup, insert, and delete operations, however due to their tree-based nature their memory footprints and the runtime performance of iteration and equality checking lag behind array-based counterparts. This particularly prohibits their application in programs which process larger data sets. In this paper, we propose changes to the HAMT design that increase the overall performance of immutable sets and maps. The resulting general purpose design increases cache locality and features a canonical representation. It outperforms Scala’s and Clojure’s data structure implementations in terms of memory footprint and runtime efficiency of iteration (1.3– 6.7 x) and equality checking (3–25.4 x).</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col margin-top--sm"><a href="https://github.com/usethesource/rascal-website/tree/website-v2/blog/blog/2015-10-30-optimizing-hash-tries.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2016/01/01/empirical-analysis-of-the-relationship-between-CC-and-SLOC/"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Empirical analysis of the relationship between CC and SLOC</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2015/03/02/from-imperative-to-functional/"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">From imperative programming to functional programming</div></a></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/GettingStarted/">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/rascal" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a href="https://github.com/usethesource" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 UseTheSource. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.d9e49a94.js"></script>
<script src="/assets/js/main.c7515b01.js"></script>
</body>
</html>