"use strict";(self.webpackChunkrascal_website=self.webpackChunkrascal_website||[]).push([[80878],{3905:(e,a,n)=>{n.d(a,{Zo:()=>d,kt:()=>u});var s=n(67294);function t(e,a,n){return a in e?Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[a]=n,e}function r(e,a){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);a&&(s=s.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),n.push.apply(n,s)}return n}function l(e){for(var a=1;a<arguments.length;a++){var n=null!=arguments[a]?arguments[a]:{};a%2?r(Object(n),!0).forEach((function(a){t(e,a,n[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(n,a))}))}return e}function i(e,a){if(null==e)return{};var n,s,t=function(e,a){if(null==e)return{};var n,s,t={},r=Object.keys(e);for(s=0;s<r.length;s++)n=r[s],a.indexOf(n)>=0||(t[n]=e[n]);return t}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(s=0;s<r.length;s++)n=r[s],a.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}var o=s.createContext({}),c=function(e){var a=s.useContext(o),n=a;return e&&(n="function"==typeof e?e(a):l(l({},a),e)),n},d=function(e){var a=c(e.components);return s.createElement(o.Provider,{value:a},e.children)},p={inlineCode:"code",wrapper:function(e){var a=e.children;return s.createElement(s.Fragment,{},a)}},m=s.forwardRef((function(e,a){var n=e.components,t=e.mdxType,r=e.originalType,o=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),m=c(n),u=t,k=m["".concat(o,".").concat(u)]||m[u]||p[u]||r;return n?s.createElement(k,l(l({ref:a},d),{},{components:n})):s.createElement(k,l({ref:a},d))}));function u(e,a){var n=arguments,t=a&&a.mdxType;if("string"==typeof e||t){var r=n.length,l=new Array(r);l[0]=m;var i={};for(var o in a)hasOwnProperty.call(a,o)&&(i[o]=a[o]);i.originalType=e,i.mdxType="string"==typeof e?e:t,l[1]=i;for(var c=2;c<r;c++)l[c]=n[c];return s.createElement.apply(null,l)}return s.createElement.apply(null,n)}m.displayName="MDXCreateElement"},899:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>o,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>c});var s=n(87462),t=(n(67294),n(3905));const r={title:"Measuring Methods"},l=void 0,i={unversionedId:"Recipes/Metrics/MeasuringJava/MeasuringMethods/index",id:"Recipes/Metrics/MeasuringJava/MeasuringMethods/index",title:"Measuring Methods",description:"Synopsis",source:"@site/docs/Recipes/Metrics/MeasuringJava/MeasuringMethods/index.md",sourceDirName:"Recipes/Metrics/MeasuringJava/MeasuringMethods",slug:"/Recipes/Metrics/MeasuringJava/MeasuringMethods/",permalink:"/docs/Recipes/Metrics/MeasuringJava/MeasuringMethods/",draft:!1,editUrl:"https://github.com/usethesource/rascal/tree/main/src/org/rascalmpl/courses/docs/Recipes/Metrics/MeasuringJava/MeasuringMethods/index.md",tags:[],version:"current",frontMatter:{title:"Measuring Methods"},sidebar:"tutorialSidebar",previous:{title:"Measuring Classes",permalink:"/docs/Recipes/Metrics/MeasuringJava/MeasuringClasses/"},next:{title:"Rascal Concepts",permalink:"/docs/RascalConcepts/"}},o={},c=[{value:"Synopsis",id:"synopsis",level:4},{value:"Examples",id:"examples",level:4},{value:"Benefits",id:"benefits",level:4},{value:"Pitfalls",id:"pitfalls",level:4}],d={toc:c};function p(e){let{components:a,...n}=e;return(0,t.kt)("wrapper",(0,s.Z)({},d,n,{components:a,mdxType:"MDXLayout"}),(0,t.kt)("h4",{id:"synopsis"},"Synopsis"),(0,t.kt)("p",null,"We demonstrate how to extract interesting and accurate information about Java methods."),(0,t.kt)("h4",{id:"examples"},"Examples"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-rascal-shell"},"rascal>import lang::java::m3::Core;\nok\nrascal>import lang::java::m3::AST;\nok\n")),(0,t.kt)("p",null,"Now we can extract our overview model, using the classpath we derived:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},"rascal>myModel = createM3FromDirectory(|tmp:///snakes-and-ladders/src|);\n")),(0,t.kt)("admonition",{type:"danger"},(0,t.kt)("p",{parentName:"admonition"},"Rascal code execution failed (unexpectedly) during compilation of this documentation.")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-rascal-shell"},"|std:///lang/java/m3/Core.rsc|(5265,16,<118,8>,<118,24>): Undeclared variable: includeJarModels\nAdvice: |http://tutor.rascal-mpl.org/Errors/Static/UndeclaredVariable/UndeclaredVariable.html|\nok\n")),(0,t.kt)("p",null,"Now let's focus on the methods:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},"rascal>myMethods = methods(myModel);\n")),(0,t.kt)("admonition",{type:"danger"},(0,t.kt)("p",{parentName:"admonition"},"Rascal code execution failed (unexpectedly) during compilation of this documentation.")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-rascal-shell"},"|prompt:///|(20,7,<1,20>,<1,27>): Undeclared variable: myModel\nAdvice: |http://tutor.rascal-mpl.org/Errors/Static/UndeclaredVariable/UndeclaredVariable.html|\nok\n")),(0,t.kt)("p",null,"What is the source code for any given method?"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},'rascal>import IO;\nok\nrascal>methodSrc = readFile(|java+method:///snakes/Square/landHereOrGoHome()|);\nstr: "public ISquare landHereOrGoHome() {\\n\\t\\treturn this.isOccupied() ? game.firstSquare() : this;\\n\\t}"\n')),(0,t.kt)("p",null,"Let's print it for readability's sake:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},"rascal>println(methodSrc)\npublic ISquare landHereOrGoHome() {\n        return this.isOccupied() ? game.firstSquare() : this;\n    }\nok\n")),(0,t.kt)("p",null,"How many words in this method? Let's use a regex :-)"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},"rascal>(0 | it + 1 | /\\W+/ := methodSrc)\nint: 9\n")),(0,t.kt)("p",null,"But now, let's get its AST"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},"rascal>methodFiles = myModel.declarations[|java+method:///snakes/Square/landHereOrGoHome()|];\n")),(0,t.kt)("admonition",{type:"danger"},(0,t.kt)("p",{parentName:"admonition"},"Rascal code execution failed (unexpectedly) during compilation of this documentation.")),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-rascal-shell"},"|prompt:///|(14,7,<1,14>,<1,21>): Undeclared variable: myModel\nAdvice: |http://tutor.rascal-mpl.org/Errors/Static/UndeclaredVariable/UndeclaredVariable.html|\nok\n")),(0,t.kt)("p",null,"Now we know what file to look in, parse it:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-rascal-shell"},'rascal>fileAST = createAstFromFile(|tmp:///snakes-and-ladders/src/snakes/Square.java|, true);\nDeclaration: compilationUnit(\n  package(\n    "snakes",\n    decl=|java+package:///snakes|,\n    src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(0,15,<1,0>,<1,15>)),\n  [],\n  [class(\n      "Square",\n      [],\n      [simpleType(simpleName(\n            "ISquare",\n            src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(48,7,<3,31>,<3,38>),\n            decl=|java+class:///ISquare|,\n            typ=class(\n              |java+class:///ISquare|,\n              [])))],\n      [\n        field(\n          int(),\n          [variable(\n              "position",\n              0,\n              src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(74,8,<5,15>,<5,23>),\n              decl=|java+field:///snakes/Square/position|,\n              typ=int())],\n          modifiers=[protected()],\n          src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(60,23,<5,1>,<5,24>)),\n        field(\n          simpleType(simpleName(\n              "Game",\n              src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(95,4,<6,11>,<6,15>),\n              decl=|java+class:///snakes/Game|,\n              typ=class(\n                |java+class:///snakes/Game|,\n                []))),\n          [variable(\n              "game",\n              0,\n              src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(100,4,<6,16>,<6,20>),\n              decl=|java+field:///snakes/Square/game|,\n              typ=class(\n                |java+class:///snakes/Game|,\n                []))],\n          modifiers=[protected()],\n          src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(85,20,<6,1>,<6,21>)),\n        field(\n          simpleType(simpleName(\n              "Player",\n              src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(115,6,<7,9>,<7,15>),\n              decl=|java+class:///snakes/Player|,\n              typ=class(\n                |java+class:///snakes/Player|,\n                []))),\n          [variable(\n              "player",\n              0,\n              src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(122,6,<7,16>,<7,22>),\n              decl=|java+field:///snakes/Square/player|,\n              typ=class(\n                |java+class:///snakes/Player|,\n                []))],\n          modifiers=[private()],\n          src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(107,22,<7,1>,<7,23>)),\n        method(\n          boolean(),\n          "invariant",\n          [],\n          [],\n          block(\n            [return(\n                infix(\n                  infix(\n                    simpleName(\n                      "game",\n                      src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(171,4,<10,9>,<10,13>),\n                      decl=|java+field:///snakes/Square/game|,\n                      typ=class(\n                        |java+class:///snakes/Game|,\n                        [])),\n                    "!=",\n                    null(\n                      src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(179,4,<10,17>,<10,21>),\n                      typ=null()),\n                    src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(171,12,<10,9>,<10,21>),\n                    typ=unresolved()),\n                  "&&",\n                  methodCall(\n                    false,\n                    simpleName(\n                      "game",\n                      src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(190,4,<11,6>,<11,10>),\n                      decl=|java+field:///snakes/Square/game|,\n                      typ=class(\n                        |java+class:///snakes/Game|,\n                        [])),\n                    "isValidPosition",\n                    [simpleName(\n                        "position",\n                        src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(211,8,<11,27>,<11,35>),\n                        decl=|java+field:///snakes/Square/position|,\n                        typ=int())],\n                    src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(190,30,<11,6>,<11,36>)...\n')),(0,t.kt)("p",null,"one of the declarations in this file is the method we wanted to see:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-rascal-shell"},'rascal>methodASTs = {d | /Declaration d := fileAST, d.decl == |java+method:///snakes/Square/landHereOrGoHome()|};\nset[Declaration]: {method(\n    simpleType(simpleName(\n        "ISquare",\n        src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(685,7,<37,8>,<37,15>),\n        decl=|java+class:///snakes/ISquare|,\n        typ=class(\n          |java+class:///snakes/ISquare|,\n          []))),\n    "landHereOrGoHome",\n    [],\n    [],\n    block(\n      [return(\n          conditional(\n            methodCall(\n              false,\n              this(\n                src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(723,4,<38,9>,<38,13>),\n                typ=class(\n                  |java+class:///snakes/Square|,\n                  [])),\n              "isOccupied",\n              [],\n              src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(723,17,<38,9>,<38,26>),\n              decl=|java+method:///snakes/Square/isOccupied()|,\n              typ=boolean()),\n            methodCall(\n              false,\n              simpleName(\n                "game",\n                src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(743,4,<38,29>,<38,33>),\n                decl=|java+field:///snakes/Square/game|,\n                typ=class(\n                  |java+class:///snakes/Game|,\n                  [])),\n              "firstSquare",\n              [],\n              src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(743,18,<38,29>,<38,47>),\n              decl=|unresolved:///|,\n              typ=unresolved()),\n            this(\n              src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(764,4,<38,50>,<38,54>),\n              typ=class(\n                |java+class:///snakes/Square|,\n                [])),\n            src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(723,45,<38,9>,<38,54>),\n            typ=unresolved()),\n          src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(716,53,<38,2>,<38,55>))],\n      src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(712,60,<37,35>,<39,2>)),\n    modifiers=[public()],\n    src=|tmp:///snakes-and-ladders/src/snakes/Square.java|(678,94,<37,1>,<39,2>),\n    decl=|java+method:///snakes/Square/landHereOrGoHome()|,\n    typ=method(\n      |java+method:///snakes/Square/landHereOrGoHome()|,\n      [],\n      class(\n        |java+class:///snakes/ISquare|,\n        []),\n      []))}\n')),(0,t.kt)("p",null,"If ",(0,t.kt)("inlineCode",{parentName:"p"},"methodASTs")," would have been an empty set, then the ",(0,t.kt)("a",{parentName:"p",href:"/docs/RascalConcepts/PatternMatching/"},"search pattern")," ",(0,t.kt)("inlineCode",{parentName:"p"},"/Declaration d")," or the condition ",(0,t.kt)("inlineCode",{parentName:"p"},"d.decl == ...")," would have failed on this example. But it didn't! It found exactly one match."),(0,t.kt)("p",null,"Now we count the number of expressions:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},"rascal>(0 | it + 1 | /Expression _ := methodASTs)\nint: 7\n")),(0,t.kt)("p",null,"or give us the locations of all expressions:"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},"rascal>[m.src | /Expression m := methodASTs]\nlist[loc]: [\n  |tmp:///snakes-and-ladders/src/snakes/Square.java|(685,7,<37,8>,<37,15>),\n  |tmp:///snakes-and-ladders/src/snakes/Square.java|(723,4,<38,9>,<38,13>),\n  |tmp:///snakes-and-ladders/src/snakes/Square.java|(723,17,<38,9>,<38,26>),\n  |tmp:///snakes-and-ladders/src/snakes/Square.java|(743,4,<38,29>,<38,33>),\n  |tmp:///snakes-and-ladders/src/snakes/Square.java|(743,18,<38,29>,<38,47>),\n  |tmp:///snakes-and-ladders/src/snakes/Square.java|(764,4,<38,50>,<38,54>),\n  |tmp:///snakes-and-ladders/src/snakes/Square.java|(723,45,<38,9>,<38,54>)\n]\n")),(0,t.kt)("p",null,"the size should be the same, right?"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},"rascal>import List;\nok\nrascal>size([m.src | /Expression m := methodASTs]) == (0 | it + 1 | /Expression _ := methodASTs)\nbool: true\n")),(0,t.kt)("h4",{id:"benefits"},"Benefits"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Click on any of the printed source ",(0,t.kt)("a",{parentName:"li",href:"/docs/Rascal/Expressions/Values/Location/"},"Location"),"s in the terminal and the IDE brings you to the file."),(0,t.kt)("li",{parentName:"ul"},"The method AST contains all structural/syntactic information about a method and its signature. They are defined in the ",(0,t.kt)("a",{parentName:"li",href:"/docs/Library/lang/java/m3/AST"},"AST")," module."),(0,t.kt)("li",{parentName:"ul"},"every node in the AST has been annotated with a ",(0,t.kt)("inlineCode",{parentName:"li"},"src")," field to explain where exactly in the file it came from"),(0,t.kt)("li",{parentName:"ul"},"when name and type resolution is ",(0,t.kt)("inlineCode",{parentName:"li"},"true")," for ",(0,t.kt)("a",{parentName:"li",href:"/docs/Library/lang/java/m3/AST#lang::java::m3::AST-createAstFromFile"},"create ast from file"),", the ",(0,t.kt)("inlineCode",{parentName:"li"},"decl")," fields on given nodes point to the resolved qualified names of a reference. These qualified names coincide with the overview ",(0,t.kt)("a",{parentName:"li",href:"/docs/Library/lang/java/m3/Core"},"M3")," model contents. "),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("a",{parentName:"li",href:"/docs/RascalConcepts/PatternMatching/"},"pattern matching")," is a very powerful way of exploring and changing ASTs"),(0,t.kt)("li",{parentName:"ul"},"AST and M3 models exist for other programming languages than Java. Your skills developed here may transfer to there."),(0,t.kt)("li",{parentName:"ul"},"AST and M3 creation is fully based on reusing the Eclipse JDT compiler stack, which has a high quality and can also recover from local errors in input files."),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("a",{parentName:"li",href:"/docs/Rascal/Expressions/Values/Location/"},"Location")," values like ",(0,t.kt)("inlineCode",{parentName:"li"},"|java+method:///org/rascalmpl/ast/Statement/VariableDeclaration/clone()|")," that occur in ASTs and M3 relations are ",(0,t.kt)("em",{parentName:"li"},"clickable")," in the terminal window and will take you to the source code identified by the URI (and the offset).")),(0,t.kt)("h4",{id:"pitfalls"},"Pitfalls"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"AST's and M3 models are a snapshot representation of the current state of the code, if source code changes on disk the models are not automatically updated."),(0,t.kt)("li",{parentName:"ul"},"M3 accuracy, and also AST accuracy, depends greatly on the quality of the ",(0,t.kt)("inlineCode",{parentName:"li"},"classPath")," provided to the extraction methods.")))}p.isMDXComponent=!0}}]);