"use strict";(self.webpackChunkrascal_website=self.webpackChunkrascal_website||[]).push([[47299],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>u});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var o=r.createContext({}),p=function(e){var t=r.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=p(e.components);return r.createElement(o.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=p(n),u=a,g=m["".concat(o,".").concat(u)]||m[u]||c[u]||i;return n?r.createElement(g,s(s({ref:t},d),{},{components:n})):r.createElement(g,s({ref:t},d))}));function u(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,s=new Array(i);s[0]=m;var l={};for(var o in t)hasOwnProperty.call(t,o)&&(l[o]=t[o]);l.originalType=e,l.mdxType="string"==typeof e?e:a,s[1]=l;for(var p=2;p<i;p++)s[p]=n[p];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},78658:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>s,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var r=n(87462),a=(n(67294),n(3905));const i={title:"String Template"},s=void 0,l={unversionedId:"Recipes/Common/StringTemplate/index",id:"Recipes/Common/StringTemplate/index",title:"String Template",description:"Synopsis",source:"@site/docs/Recipes/Common/StringTemplate/index.md",sourceDirName:"Recipes/Common/StringTemplate",slug:"/Recipes/Common/StringTemplate/",permalink:"/docs/Recipes/Common/StringTemplate/",draft:!1,editUrl:"https://github.com/usethesource/rascal/tree/main/src/org/rascalmpl/courses/docs/Recipes/Common/StringTemplate/index.md",tags:[],version:"current",frontMatter:{title:"String Template"},sidebar:"tutorialSidebar",previous:{title:"Derivative",permalink:"/docs/Recipes/Common/Derivative/"},next:{title:"Word Count",permalink:"/docs/Recipes/Common/WordCount/"}},o={},p=[{value:"Synopsis",id:"synopsis",level:4},{value:"Description",id:"description",level:4},{value:"Examples",id:"examples",level:4},{value:"Benefits",id:"benefits",level:4},{value:"Pitfalls",id:"pitfalls",level:4}],d={toc:p};function c(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h4",{id:"synopsis"},"Synopsis"),(0,a.kt)("p",null,"Using string templates to generate code."),(0,a.kt)("h4",{id:"description"},"Description"),(0,a.kt)("p",null,'Many websites and code generators use template-based code generation. They start from a text template that contains embedded variables and code. The template is "executed" by replacing the embedded variables and code by their string value. Languages like PHP and Ruby are popular for this feature. Let\'s see how we can do this in Rascal. '),(0,a.kt)("p",null,"Rascal provides string templates that rival what is provided in\n",(0,a.kt)("a",{parentName:"p",href:"http://www.ruby-doc.org/stdlib/libdoc/erb/rdoc/ERB.html"},"Ruby"),", ",(0,a.kt)("a",{parentName:"p",href:"http://www.php.net/"},"PHP")," or ",(0,a.kt)("a",{parentName:"p",href:"http://www.stringtemplate.org/"},"ANTLR"),".\nThey are fully described in ",(0,a.kt)("a",{parentName:"p",href:"/docs/Rascal/Expressions/Values/String/"},"string values"),"."),(0,a.kt)("h4",{id:"examples"},"Examples"),(0,a.kt)("p",null,"The problem we want to solve is as follows:\ngiven a number of fields (with a name and a type)\nhow can we generate a Java class with getters and setters for those fields?"),(0,a.kt)("p",null,"Here is a solution:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-rascal"},"\nmodule demo::common::StringTemplate\n\nimport String;\nimport List;\n\n\nstr capitalize(str s) = \"<toUpperCase(s[0])><s[1..]>\";\n  \n\nprivate str genSetter(map[str,str] fields, str x) {\n  return \"public void set<capitalize(x)>(<fields[x]> <x>) {\n         '  this.<x> = <x>;\n         '}\";\n}\n\n\nprivate str genGetter(map[str,str] fields, str x) {\n  return \"public <fields[x]> get<capitalize(x)>() {\n         '  return <x>;\n         '}\";\n}\n\n\nstr genClass(str name, map[str,str] fields) { // <2>\n  return \n    \"public class <name> {\n    '  <for (x <- sort([f | f <- fields])) {>\n    '  private <fields[x]> <x>;\n    '  <genSetter(fields, x)>\n    '  <genGetter(fields, x)><}>\n    '}\";\n}\n\nmap[str, str] fields = (\n     \"name\" : \"String\",\n     \"age\" : \"Integer\",\n     \"address\" : \"String\"\n  );\n  \nstr cperson = \n  // Do not change a single space in the string below! (for testing purposes)\n  \"public class Person {\n    '  \n    '  private String address;\n    '  public void setAddress(String address) {\n    '    this.address = address;\n    '  }\n    '  public String getAddress() {\n    '    return address;\n    '  }\n    '  private Integer age;\n    '  public void setAge(Integer age) {\n    '    this.age = age;\n    '  }\n    '  public Integer getAge() {\n    '    return age;\n    '  }\n    '  private String name;\n    '  public void setName(String name) {\n    '    this.name = name;\n    '  }\n    '  public String getName() {\n    '    return name;\n    '  }\n    '}\";\n\n")),(0,a.kt)("p",null,"<1> An auxiliary function ",(0,a.kt)("inlineCode",{parentName:"p"},"capitalize")," is defined to capitalize the first character of a string."),(0,a.kt)("p",null,"<2> Here is the heavy lifting done: ",(0,a.kt)("inlineCode",{parentName:"p"},"genClass")," is defined that takes as arguments:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"the ",(0,a.kt)("inlineCode",{parentName:"li"},"name")," of the class, and"),(0,a.kt)("li",{parentName:"ul"},"a map ",(0,a.kt)("inlineCode",{parentName:"li"},"fields")," that associates field names with their type (both string values).")),(0,a.kt)("p",null,"Function ",(0,a.kt)("inlineCode",{parentName:"p"},"genClass")," returns a string that contains several ",(0,a.kt)("em",{parentName:"p"},"string interpolations")," delimited by ",(0,a.kt)("inlineCode",{parentName:"p"},"<")," and ",(0,a.kt)("inlineCode",{parentName:"p"},">"),".\nLet's discuss some of them:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"In each line, only the text following ",(0,a.kt)("inlineCode",{parentName:"li"},"'")," is contributed to the output. The text before (and including) ",(0,a.kt)("inlineCode",{parentName:"li"},"'")," can be used to properly indent\nthe string."),(0,a.kt)("li",{parentName:"ul"},"The output of each interpolated call, like to ",(0,a.kt)("inlineCode",{parentName:"li"},"genMethod")," is auto-indented."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"public class <name>"),": insert the desired class name in the result."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"<for x<-fields){>")," ... ",(0,a.kt)("inlineCode",{parentName:"li"},"<}>"),": loops over the fields and contributes the text produced by its body to the result."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"private <fields[x]> <x>;"),": finds for the current field ",(0,a.kt)("inlineCode",{parentName:"li"},"x")," its type and produces an appropriate private field declaration."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"public void set<capitalize(x)>(<fields[x]> <x>)"),": method header for the setter for field ",(0,a.kt)("inlineCode",{parentName:"li"},"x"),".")),(0,a.kt)("p",null,"Let's see how this works out on actual data:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-rascal-shell"},'rascal>import demo::common::StringTemplate;\nok\nrascal>import IO;\nok\nrascal>fields = (\n>>>>>>>     "name" : "String",\n>>>>>>>     "age" : "Integer",\n>>>>>>>     "address" : "String"\n>>>>>>>  );\nmap[str, str]: ("name":"String","address":"String","age":"Integer")\nrascal>println(genClass("Person", fields));\nprintln(genClass("Person", fields));\npublic class Person {\n  \n  private String address;\n  public void setAddress(String address) {\n    this.address = address;\n  }\n  public String getAddress() {\n    return address;\n  }\n  private Integer age;\n  public void setAge(Integer age) {\n    this.age = age;\n  }\n  public Integer getAge() {\n    return age;\n  }\n  private String name;\n  public void setName(String name) {\n    this.name = name;\n  }\n  public String getName() {\n    return name;\n  }\n}\nok\n')),(0,a.kt)("h4",{id:"benefits"},"Benefits"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"String templates are ideal to generate arbitrary output. In particular, no grammar is needed to describe this output."),(0,a.kt)("li",{parentName:"ul"},"Auto-indent helps to be able to compose templates from reusable parts.")),(0,a.kt)("h4",{id:"pitfalls"},"Pitfalls"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"Since no grammar is used to control output, errors in generated code can only be detected by a downstream processor such as a compiler for the generated code.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},"In more complex cases, it can be better to introduce an abstract datatype to represent the desired code and to use string templates to\nproduce the actual textual representation of that code."))))}c.isMDXComponent=!0}}]);