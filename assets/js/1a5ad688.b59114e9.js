"use strict";(self.webpackChunkrascal_website=self.webpackChunkrascal_website||[]).push([[14339],{3905:(e,a,t)=>{t.d(a,{Zo:()=>d,kt:()=>u});var n=t(67294);function r(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function s(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?s(Object(t),!0).forEach((function(a){r(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function o(e,a){if(null==e)return{};var t,n,r=function(e,a){if(null==e)return{};var t,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||(r[t]=e[t]);return r}(e,a);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)t=s[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var i=n.createContext({}),c=function(e){var a=n.useContext(i),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},d=function(e){var a=c(e.components);return n.createElement(i.Provider,{value:a},e.children)},p={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},m=n.forwardRef((function(e,a){var t=e.components,r=e.mdxType,s=e.originalType,i=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),m=c(t),u=r,h=m["".concat(i,".").concat(u)]||m[u]||p[u]||s;return t?n.createElement(h,l(l({ref:a},d),{},{components:t})):n.createElement(h,l({ref:a},d))}));function u(e,a){var t=arguments,r=a&&a.mdxType;if("string"==typeof e||r){var s=t.length,l=new Array(s);l[0]=m;var o={};for(var i in a)hasOwnProperty.call(a,i)&&(o[i]=a[i]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var c=2;c<s;c++)l[c]=t[c];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}m.displayName="MDXCreateElement"},34276:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>i,contentTitle:()=>l,default:()=>p,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var n=t(87462),r=(t(67294),t(3905));const s={title:"Measuring Classes"},l=void 0,o={unversionedId:"Recipes/Metrics/MeasuringJava/MeasuringClasses/index",id:"Recipes/Metrics/MeasuringJava/MeasuringClasses/index",title:"Measuring Classes",description:"Synopsis",source:"@site/docs/Recipes/Metrics/MeasuringJava/MeasuringClasses/index.md",sourceDirName:"Recipes/Metrics/MeasuringJava/MeasuringClasses",slug:"/Recipes/Metrics/MeasuringJava/MeasuringClasses/",permalink:"/docs/Recipes/Metrics/MeasuringJava/MeasuringClasses/",draft:!1,editUrl:"https://github.com/usethesource/rascal/tree/main/src/org/rascalmpl/courses/docs/Recipes/Metrics/MeasuringJava/MeasuringClasses/index.md",tags:[],version:"current",frontMatter:{title:"Measuring Classes"},sidebar:"tutorialSidebar",previous:{title:"Measuring Java",permalink:"/docs/Recipes/Metrics/MeasuringJava/"},next:{title:"Measuring Methods",permalink:"/docs/Recipes/Metrics/MeasuringJava/MeasuringMethods/"}},i={},c=[{value:"Synopsis",id:"synopsis",level:4},{value:"Examples",id:"examples",level:4},{value:"Benefits",id:"benefits",level:4},{value:"Pitfalls",id:"pitfalls",level:4}],d={toc:c};function p(e){let{components:a,...t}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,t,{components:a,mdxType:"MDXLayout"}),(0,r.kt)("h4",{id:"synopsis"},"Synopsis"),(0,r.kt)("p",null,"A typical example of how to use M3 to analyze Java classes."),(0,r.kt)("h4",{id:"examples"},"Examples"),(0,r.kt)("p",null,"First we import the basic data types for representing Java. The model is called ",(0,r.kt)("em",{parentName:"p"},"M3"),", and its definition is split acros a generic\nlanguage independent module called ","[Rascal:analysis/m3/Core]"," and a Java specific part called ","[Rascal:lang/java/m3/Core]",". Have a look at the documentation\nof these modules later. For now we will go through using them in a few examples."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell"},"rascal>import lang::java::m3::Core;\nok\nrascal>import lang::java::m3::AST;\nok\n")),(0,r.kt)("p",null,'"Snakes and Ladders" is an example Java project of which we have stored the source code in ',(0,r.kt)("inlineCode",{parentName:"p"},"|tmp:///snakes-and-ladders/src|")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},"rascal>|tmp:///snakes-and-ladders/src/snakes/|.ls\nlist[loc]: [\n  |tmp:///snakes-and-ladders/src/snakes/Die.java|,\n  |tmp:///snakes-and-ladders/src/snakes/SimpleGameTest.java|,\n  |tmp:///snakes-and-ladders/src/snakes/LastSquare.java|,\n  |tmp:///snakes-and-ladders/src/snakes/Snake.java|,\n  |tmp:///snakes-and-ladders/src/snakes/Ladder.java|,\n  |tmp:///snakes-and-ladders/src/snakes/FirstSquare.java|,\n  |tmp:///snakes-and-ladders/src/snakes/DieTest.java|,\n  |tmp:///snakes-and-ladders/src/snakes/Player.java|,\n  |tmp:///snakes-and-ladders/src/snakes/Game.java|,\n  |tmp:///snakes-and-ladders/src/snakes/ISquare.java|,\n  |tmp:///snakes-and-ladders/src/snakes/Square.java|\n]\n")),(0,r.kt)("p",null,"Now we can extract our overview model, using the classpath we derived:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},"rascal>myModel = createM3FromDirectory(|tmp:///snakes-and-ladders/src|);\n")),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"Rascal code execution failed (unexpectedly) during compilation of this documentation.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell"},"|std:///lang/java/m3/Core.rsc|(5265,16,<118,8>,<118,24>): Undeclared variable: includeJarModels\nAdvice: |http://tutor.rascal-mpl.org/Errors/Static/UndeclaredVariable/UndeclaredVariable.html|\nok\n")),(0,r.kt)("p",null,"Next, let's focus on the ",(0,r.kt)("em",{parentName:"p"},"containment")," relation. This defines what parts of the source code are parts of which other parts:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},"rascal>myModel.containment\n")),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"Rascal code execution failed (unexpectedly) during compilation of this documentation.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell"},"|prompt:///|(0,7,<1,0>,<1,7>): Undeclared variable: myModel\nAdvice: |http://tutor.rascal-mpl.org/Errors/Static/UndeclaredVariable/UndeclaredVariable.html|\nok\n")),(0,r.kt)("p",null,"You are looking at a binary relation of type ",(0,r.kt)("inlineCode",{parentName:"p"},"rel[loc from,loc to]"),", where ",(0,r.kt)("inlineCode",{parentName:"p"},"from")," is the container and ",(0,r.kt)("inlineCode",{parentName:"p"},"to")," is the contained item. Each tuple, or row if you will, maps a container to a contained item."),(0,r.kt)("p",null,"As you can read, classes contain methods, methods contain variables, etc. Classes could also contain other classes (nested classes), and methods can even contain classes (anonymous classes). Let's focus on a specific class, and project what it contains from the relation:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},'rascal>import IO;\nok\nrascal>println(readFile(|java+class:///snakes/Snake|))\npublic class Snake extends Ladder {\n\n    public Snake(int transport, Game game, int position) {\n        super(transport, game, position);\n    }\n\n    @Override\n    protected String squareLabel() {\n        return this.destination().position() + "<-" + position;\n    }\n\n}\nok\nrascal>myModel.containment[|java+class:///snakes/Snake|]\n')),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"Rascal code execution failed (unexpectedly) during compilation of this documentation.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell"},"|prompt:///|(0,7,<1,0>,<1,7>): Undeclared variable: myModel\nAdvice: |http://tutor.rascal-mpl.org/Errors/Static/UndeclaredVariable/UndeclaredVariable.html|\nok\n")),(0,r.kt)("p",null,"Let's filter the methods:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},'rascal>snakeMethods = [ e | e <- myModel.containment[|java+class:///snakes/Snake|], e.scheme == "java+method"];\n')),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"Rascal code execution failed (unexpectedly) during compilation of this documentation.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell"},"|prompt:///|(26,7,<1,26>,<1,33>): Undeclared variable: myModel\nAdvice: |http://tutor.rascal-mpl.org/Errors/Static/UndeclaredVariable/UndeclaredVariable.html|\nok\n")),(0,r.kt)("p",null,"And we are ready to compute our first metric. How many methods does this class contain?"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},"rascal>import List;\nok\nrascal>size(snakeMethods)\n")),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"Rascal code execution failed (unexpectedly) during compilation of this documentation.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell"},"|prompt:///|(5,12,<1,5>,<1,17>): Undeclared variable: snakeMethods\nAdvice: |http://tutor.rascal-mpl.org/Errors/Static/UndeclaredVariable/UndeclaredVariable.html|\nok\n")),(0,r.kt)("p",null,"No magic applied! It is just a little query on a model that knows everything about the code. "),(0,r.kt)("p",null,"Note that some people define Java's constructors also as methods! In that case our metric is wrong and we should fix it.\nThe quality of a metric's implementation is defined by its independent definition."),(0,r.kt)("p",null,"Let's generalize and compute the number of methods for all classes in one big expression. First we make a new function to compute the number for any given class. Now we reuse ",(0,r.kt)("inlineCode",{parentName:"p"},"isMethod")," for a change, which includes normal methods, constructors and static initializers:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},"rascal>int numberOfMethods(loc cl, M3 model) = size([ m | m <- model.containment[cl], isMethod(m)]);\nint (loc, M3): function(|prompt:///|(0,93,<1,0>,<1,93>))\nrascal>numberOfMethods(|java+class:///snakes/Snake|, myModel)\n")),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"Rascal code execution failed (unexpectedly) during compilation of this documentation.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell"},"|prompt:///|(46,7,<1,46>,<1,53>): Undeclared variable: myModel\nAdvice: |http://tutor.rascal-mpl.org/Errors/Static/UndeclaredVariable/UndeclaredVariable.html|\nok\n")),(0,r.kt)("p",null,"Then we apply this new function to give us a map from classes to integers:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},"rascal>classes(myModel)\n")),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"Rascal code execution failed (unexpectedly) during compilation of this documentation.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell"},"|prompt:///|(8,7,<1,8>,<1,15>): Undeclared variable: myModel\nAdvice: |http://tutor.rascal-mpl.org/Errors/Static/UndeclaredVariable/UndeclaredVariable.html|\nok\nrascal>map[loc class, int methodCount] numberOfMethodsPerClass = (cl:numberOfMethods(cl, myModel) | cl <- classes(myModel));\n")),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"Rascal code execution failed (unexpectedly) during compilation of this documentation.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell"},"|prompt:///|(107,7,<1,107>,<1,114>): Undeclared variable: myModel\nAdvice: |http://tutor.rascal-mpl.org/Errors/Static/UndeclaredVariable/UndeclaredVariable.html|\nok\n")),(0,r.kt)("p",null,"How about the number of fields?"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},"rascal>int numberOfFields(loc cl, M3 model) = size([ m | m <- model.containment[cl], isField(m)]);\nint (loc, M3): function(|prompt:///|(0,91,<1,0>,<1,91>))\nrascal>map[loc class, int fieldCount] numberOfFieldsPerClass = (cl:numberOfFields(cl, myModel) | cl <- classes(myModel));\n")),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"Rascal code execution failed (unexpectedly) during compilation of this documentation.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell"},"|prompt:///|(104,7,<1,104>,<1,111>): Undeclared variable: myModel\nAdvice: |http://tutor.rascal-mpl.org/Errors/Static/UndeclaredVariable/UndeclaredVariable.html|\nok\n")),(0,r.kt)("p",null,"What is the ratio between fields and methods for each class?"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},"rascal>(cl : (numberOfFieldsPerClass[cl] * 1.0) / (numberOfMethodsPerClass[cl] * 1.0) | cl <- classes(myModel))\n")),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"Rascal code execution failed (unexpectedly) during compilation of this documentation.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell"},"|prompt:///|(95,7,<1,95>,<1,102>): Undeclared variable: myModel\nAdvice: |http://tutor.rascal-mpl.org/Errors/Static/UndeclaredVariable/UndeclaredVariable.html|\nok\n")),(0,r.kt)("p",null,"There is a lot more to discover in M3 models. These are the currently available relations in an M3 model:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell",metastring:",continue",",continue":!0},'rascal>import Node;\nok\nrascal>import Set;\nok\nrascal>for (r <- sort(getKeywordParameters(myModel)<0>)) println("  <r>");\n')),(0,r.kt)("admonition",{type:"danger"},(0,r.kt)("p",{parentName:"admonition"},"Rascal code execution failed (unexpectedly) during compilation of this documentation.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-rascal-shell"},"|prompt:///|(36,7,<1,36>,<1,43>): Undeclared variable: myModel\nAdvice: |http://tutor.rascal-mpl.org/Errors/Static/UndeclaredVariable/UndeclaredVariable.html|\nok\n")),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"/docs/Library/analysis/m3/Core"},"Core")," for the definition of the language-independent relations and ",(0,r.kt)("a",{parentName:"p",href:"/docs/Library/lang/java/m3/Core"},"Core")," for the Java-specific extensions."),(0,r.kt)("h4",{id:"benefits"},"Benefits"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Rascal values, such as M3 models, are fully text-based. That means what you see on screen is what is in memory, and vice versa. Nothing is hidden or implicit. No magic!"),(0,r.kt)("li",{parentName:"ul"},"Using relational calculus operators like ",(0,r.kt)("a",{parentName:"li",href:"/docs/Rascal/Expressions/Values/Set/Intersection/"},"Intersection"),", ",(0,r.kt)("a",{parentName:"li",href:"/docs/Rascal/Expressions/Values/Set/Union/"},"Union"),", ",(0,r.kt)("a",{parentName:"li",href:"/docs/Rascal/Expressions/Values/Relation/Composition/"},"Composition"),", ",(0,r.kt)("a",{parentName:"li",href:"/docs/Rascal/Expressions/Values/Set/Comprehension/"},"Comprehension")," you can query M3 models in many different ways."),(0,r.kt)("li",{parentName:"ul"},"M3 models encapsulate ",(0,r.kt)("em",{parentName:"li"},"everything")," there is to know about the structure of a Java project. Using the knowledge of the Eclipse JDT compiler we derive types and names, semantic relations that can be queried at will."),(0,r.kt)("li",{parentName:"ul"},"M3 models are ",(0,r.kt)("em",{parentName:"li"},"composable"),"; you could extract them for different projects that depend on each-other and combine them before running an analysis on the whole"),(0,r.kt)("li",{parentName:"ul"},"There are other M3 models for other languages, with similar ideas and design. You can transfer your analysis skills to those lanaguges, but also make analyses that cross the boundaries of programming languages (consider javascript and java, or java and C via JNI, etc.)")),(0,r.kt)("h4",{id:"pitfalls"},"Pitfalls"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Inaccurate query results are possible even though the M3 models are 100% accurate. ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"M3 models are ",(0,r.kt)("em",{parentName:"li"},"initial")," in the sense that they contain what can be statically derived from the source code in terms of declarations and relations. "),(0,r.kt)("li",{parentName:"ul"},"Analyses based directly on this information can still be ",(0,r.kt)("em",{parentName:"li"},"inaccurate"),"; simply because they represent harder questions."),(0,r.kt)("li",{parentName:"ul"},"For example, a Java call graph produced by the relation composition ",(0,r.kt)("inlineCode",{parentName:"li"},"myModel.methodInvocation o myModel.methodOverrides")," shows ",(0,r.kt)("em",{parentName:"li"},"all")," possible concrete methods that could be invoked via virtual method invocation (over-approximation), but it skips all the invokes constructed via reflection (under-aproximation). In that sense this query is both incomplete and unsound, however useful it may be."))),(0,r.kt)("li",{parentName:"ul"},"Java still has the most complete M3 model in the Rascal ecosystem, so when you move to other languages prepare to extract more information from AST models instead.")))}p.isMDXComponent=!0}}]);